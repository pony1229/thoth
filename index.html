<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰˜ç‰¹å¡”ç¾…æŠ½ç‰Œå™¨</title>
  <meta name="description" content="ä½¿ç”¨æ‰˜ç‰¹å¡”ç¾…ç‰Œé€²è¡Œå„ç¨®ç‰Œé™£ï¼šæ™‚é–“ä¹‹æµã€è–ä¸‰è§’ã€ç›´æŒ‡æ ¸å¿ƒã€äºŒé¸ä¸€ï¼å¤šé¸ä¸€ã€è–åå­—ã€‚ç®¡ç†ç´€éŒ„ã€åˆ†äº«çµæœã€åˆ‡æ›ä¸»é¡Œèˆ‡å¸¸ç”¨å•é¡Œã€‚">
  <style>
    /* CSS è®Šæ•¸çµ±ä¸€ç®¡ç†ä¸»é¡Œè‰²å½© */
    :root {
      --bg-gradient-start: #1e2a3a;
      --bg-gradient-end: #2c3e50;
      --text-primary: #e0e6ed;
      --text-secondary: #a4c3f0;
      --card-bg: #273649;
      --input-bg: #304258;
      --btn-primary: #4a6fa5;
      --btn-hover: #6c91cc;
      --btn-small: #3d5679;
      --history-bg: #1f2b3a;
      --shadow-color: rgba(0,0,0,0.3);
      --card-back: linear-gradient(135deg, #2c3e50 0%, #4a6fa5 50%, #2c3e50 100%);
      --modal-overlay: rgba(0,0,0,0.8);
    }

    body.light-mode {
      --bg-gradient-start: #e3eaf2;
      --bg-gradient-end: #f5f9fc;
      --text-primary: #232f45;
      --text-secondary: #4a6fa5;
      --card-bg: #ffffff;
      --input-bg: #dde6f0;
      --btn-primary: #6b8bbd;
      --btn-hover: #8eaadd;
      --btn-small: #9caecc;
      --history-bg: #e8eff7;
      --shadow-color: rgba(0,0,0,0.15);
      --card-back: linear-gradient(135deg, #6b8bbd 0%, #a4c3f0 50%, #6b8bbd 100%);
      --modal-overlay: rgba(255,255,255,0.9);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", "Noto Sans TC", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 40px 15px;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(to bottom, var(--bg-gradient-start), var(--bg-gradient-end));
      color: var(--text-primary);
      transition: background 0.3s, color 0.3s;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
      color: var(--text-secondary);
      text-shadow: 0 2px 4px var(--shadow-color);
    }

    /* è¼¸å…¥æ¡†æ¨£å¼ */
    input[type="text"] {
      margin-top: 10px;
      padding: 12px 16px;
      width: 300px;
      max-width: 90vw;
      font-size: 1rem;
      border: 2px solid transparent;
      border-radius: 8px;
      background: var(--input-bg);
      color: var(--text-primary);
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input[type="text"]:focus {
      border-color: var(--btn-primary);
      box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
    }

    input[type="text"]::placeholder {
      color: var(--text-primary);
      opacity: 0.6;
    }

    /* é¸æ“‡æ¡†æ¨£å¼ */
    select {
      padding: 10px 14px;
      font-size: 0.95rem;
      border: none;
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--text-primary);
      cursor: pointer;
      outline: none;
    }

    /* æŒ‰éˆ•æ¨£å¼ */
    button {
      margin-top: 10px;
      padding: 10px 18px;
      font-size: 0.95rem;
      border: none;
      border-radius: 8px;
      background: var(--btn-primary);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px var(--shadow-color);
    }

    button:hover {
      background: var(--btn-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow-color);
    }

    button:active {
      transform: translateY(0);
    }

    .small-btn {
      margin-left: 8px;
      padding: 6px 12px;
      font-size: 0.8rem;
      background: var(--btn-small);
      border-radius: 5px;
      box-shadow: none;
    }

    .small-btn:hover {
      transform: none;
      box-shadow: none;
      opacity: 0.9;
    }

    /* ä¸»è¦æŠ½ç‰ŒæŒ‰éˆ•ç‰¹æ®Šæ¨£å¼ */
    .btn-draw {
      background: linear-gradient(135deg, #4a6fa5, #6c91cc);
      font-size: 1.1rem;
      padding: 12px 28px;
      position: relative;
      overflow: hidden;
    }

    .btn-draw::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn-draw:hover::before {
      left: 100%;
    }

    /* çµæœå€åŸŸ */
    #result {
      margin-top: 25px;
      font-size: 1rem;
      text-align: center;
      white-space: pre-line;
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      color: var(--text-primary);
      box-shadow: 0 4px 20px var(--shadow-color);
      line-height: 1.6;
      min-height: 60px;
    }

    /* ç‰Œé¢åœ–ç‰‡å€åŸŸ */
    #images {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      perspective: 1000px;
    }

    /* ç‰Œé¢å¡ç‰‡å®¹å™¨ */
    .card-container {
      position: relative;
      width: 120px;
      height: 180px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .card-container:hover {
      transform: scale(1.05);
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }

    .card-container.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      box-shadow: 0 4px 15px var(--shadow-color);
    }

    .card-front {
      transform: rotateY(180deg);
    }

    .card-front img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }

    .card-back {
      background: var(--card-back);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid var(--text-secondary);
    }

    .card-back::before {
      content: 'ğŸŒ™';
      font-size: 2.5rem;
      opacity: 0.8;
    }

    .card-label {
      position: absolute;
      bottom: -28px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: var(--text-secondary);
      white-space: nowrap;
      text-align: center;
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* è–åå­—ç‰Œé™£ç‰¹æ®Šä½ˆå±€ */
    #images.celtic-layout {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-template-rows: repeat(4, 150px);
      gap: 10px;
      justify-content: center;
      width: auto;
      max-width: 500px;
    }

    #images.celtic-layout .card-container {
      width: 90px;
      height: 135px;
    }

    /* è–åå­—ä½ç½®å®šç¾© */
    #images.celtic-layout .celtic-1 { grid-column: 2; grid-row: 2; }
    #images.celtic-layout .celtic-2 { grid-column: 2; grid-row: 2; transform: rotate(90deg) scale(0.85); z-index: 1; }
    #images.celtic-layout .celtic-3 { grid-column: 2; grid-row: 3; }
    #images.celtic-layout .celtic-4 { grid-column: 1; grid-row: 2; }
    #images.celtic-layout .celtic-5 { grid-column: 2; grid-row: 1; }
    #images.celtic-layout .celtic-6 { grid-column: 3; grid-row: 2; }
    #images.celtic-layout .celtic-7 { grid-column: 4; grid-row: 4; }
    #images.celtic-layout .celtic-8 { grid-column: 4; grid-row: 3; }
    #images.celtic-layout .celtic-9 { grid-column: 4; grid-row: 2; }
    #images.celtic-layout .celtic-10 { grid-column: 4; grid-row: 1; }

    /* éŸ¿æ‡‰å¼èª¿æ•´ */
    @media (max-width: 768px) {
      .card-container {
        width: 100px;
        height: 150px;
      }

      #images.celtic-layout {
        grid-template-columns: repeat(4, 80px);
        grid-template-rows: repeat(4, 120px);
      }

      #images.celtic-layout .card-container {
        width: 72px;
        height: 108px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem;
      }

      .card-container {
        width: 85px;
        height: 127px;
      }

      #images.celtic-layout {
        grid-template-columns: repeat(4, 65px);
        grid-template-rows: repeat(4, 98px);
      }

      #images.celtic-layout .card-container {
        width: 58px;
        height: 87px;
      }

      .card-label {
        font-size: 0.65rem;
        bottom: -22px;
      }
    }

    /* æ­·å²ç´€éŒ„å€ */
    #history {
      margin-top: 40px;
      width: 90%;
      max-width: 650px;
      font-size: 0.9rem;
    }

    #history h3 {
      color: var(--text-secondary);
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .history-entry {
      background: var(--history-bg);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 12px;
      box-shadow: 0 2px 10px var(--shadow-color);
      transition: transform 0.2s;
    }

    .history-entry:hover {
      transform: translateX(5px);
    }

    .history-entry pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      margin: 0;
      line-height: 1.5;
    }

    .history-entry-buttons {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    /* æ§åˆ¶å€ä½ˆå±€ */
    #spread-select {
      width: 90%;
      max-width: 700px;
      margin-top: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    #spreadDesc {
      width: 90%;
      max-width: 700px;
      margin-top: 15px;
      font-size: 0.9rem;
      white-space: pre-line;
      text-align: center;
      opacity: 0.85;
    }

    /* æ­·å²æ§åˆ¶èˆ‡å¸¸ç”¨å•é¡Œ */
    #history-controls {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    #history-prompts {
      margin-top: 25px;
      padding: 20px;
      background: var(--history-bg);
      border-radius: 10px;
    }

    #history-prompts h4 {
      margin: 0 0 15px 0;
      color: var(--text-secondary);
    }

    #promptList {
      list-style-type: none;
      padding: 0;
      margin-bottom: 15px;
    }

    #promptList li {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #promptList li span {
      cursor: pointer;
      text-decoration: underline;
      flex: 1;
      transition: color 0.2s;
    }

    #promptList li span:hover {
      color: var(--text-secondary);
    }

    /* è©³æƒ…æŠ˜ç–Šå€ */
    details {
      width: 90%;
      max-width: 700px;
      margin-top: 20px;
      font-size: 0.9rem;
      background: var(--history-bg);
      border-radius: 10px;
      padding: 15px;
    }

    details summary {
      cursor: pointer;
      font-weight: bold;
      color: var(--text-secondary);
      padding: 5px 0;
    }

    details[open] summary {
      margin-bottom: 10px;
      border-bottom: 1px solid var(--btn-small);
      padding-bottom: 10px;
    }

    details h4 {
      color: var(--text-secondary);
      margin: 15px 0 10px 0;
    }

    details ul {
      padding-left: 20px;
      line-height: 1.8;
    }

    /* ç‰Œç¾©è©³æƒ…å½ˆçª— */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-overlay);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--btn-small);
    }

    .modal-header h2 {
      margin: 0;
      color: var(--text-secondary);
      font-size: 1.3rem;
    }

    .modal-close {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-primary);
      padding: 5px;
      margin: 0;
      box-shadow: none;
    }

    .modal-close:hover {
      color: var(--text-secondary);
      background: transparent;
      transform: none;
    }

    .modal-body {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .modal-card-image {
      width: 150px;
      height: 225px;
      border-radius: 10px;
      object-fit: cover;
      box-shadow: 0 4px 15px var(--shadow-color);
    }

    .modal-card-info {
      flex: 1;
      min-width: 200px;
    }

    .modal-card-info p {
      margin: 10px 0;
      line-height: 1.6;
    }

    .modal-card-info .label {
      color: var(--text-secondary);
      font-weight: bold;
    }

    .element-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      margin-top: 5px;
    }

    .element-fire { background: rgba(255, 87, 34, 0.3); color: #ff7043; }
    .element-water { background: rgba(33, 150, 243, 0.3); color: #64b5f6; }
    .element-air { background: rgba(255, 235, 59, 0.3); color: #ffd54f; }
    .element-earth { background: rgba(76, 175, 80, 0.3); color: #81c784; }

    /* è¼‰å…¥å‹•ç•« */
    .loading-spinner {
      display: none;
      width: 40px;
      height: 40px;
      border: 3px solid var(--btn-small);
      border-top-color: var(--text-secondary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    .loading-spinner.active {
      display: block;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Toast é€šçŸ¥ */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--btn-primary);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 15px var(--shadow-color);
      transition: transform 0.3s ease;
      z-index: 1001;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>
  <h1>ğŸƒ æ‰˜ç‰¹å¡”ç¾…æŠ½ç‰Œå™¨</h1>

  <!-- å•é¡Œè¼¸å…¥æ¡† -->
  <input type="text" id="question" placeholder="è¼¸å…¥ä½ çš„å•é¡Œï¼ˆå¯ç•™ç©ºï¼‰" aria-label="è¼¸å…¥å•é¡Œ">

  <!-- ç‰Œé™£é¸æ“‡èˆ‡æŠ½ç‰ŒæŒ‰éˆ• -->
  <div id="spread-select">
    <label for="spread">é¸æ“‡ç‰Œé™£ï¼š</label>
    <select id="spread" onchange="updateSpreadDescription()">
      <option value="single">å–®å¼µç‰Œ</option>
      <option value="flow" selected>ä¸‰å¼µç‰Œ â€” æ™‚é–“ä¹‹æµ</option>
      <option value="trinity">ä¸‰å¼µç‰Œ â€” è–ä¸‰è§’</option>
      <option value="core">å››å¼µç‰Œ â€” ç›´æŒ‡æ ¸å¿ƒ</option>
      <option value="decision">äº”å¼µç‰Œ â€” äºŒé¸ä¸€ï¼å¤šé¸ä¸€</option>
      <option value="celtic">åå¼µç‰Œ â€” è–åå­—</option>
    </select>
    <button class="btn-draw" aria-label="æŠ½ç‰Œ" onclick="drawSpread()">âœ¨ æŠ½ç‰Œ</button>
    <button aria-label="è¤‡è£½çµæœ" onclick="copyResult()">ğŸ“‹ è¤‡è£½</button>
    <button aria-label="æ¸…ç©ºçµæœ" onclick="resetAll()">ğŸ”„ æ¸…ç©º</button>
  </div>

  <!-- ç‰Œé™£èªªæ˜ -->
  <div id="spreadDesc"></div>

  <!-- å…ƒç´ èˆ‡ç‰Œæ„èªªæ˜æŠ˜ç–Šå€ -->
  <details id="elementGuide">
    <summary>ğŸ” å…ƒç´ èˆ‡ç‰Œæ„èªªæ˜</summary>
    <h4>å››å¤§å…ƒç´ </h4>
    <ul>
      <li><strong>ğŸ”¥ ç«</strong> â€” æ„Ÿæ€§ã€ä¸»å‹•ã€é›†ä¸­ï¼Œè±¡å¾µæ„å¿—ã€è¡Œå‹•èˆ‡ç†±æƒ…ã€‚ç«å¸¶ä¾†å‹•åŠ›èˆ‡å†’éšªç²¾ç¥ï¼Œä½†éæ–¼ç†¾ç†±å¯èƒ½è‡ªæˆ‘ä¸­å¿ƒã€å¿½ç•¥ä»–äººã€‚</li>
      <li><strong>ğŸ’§ æ°´</strong> â€” æ„Ÿæ€§ã€è¢«å‹•ã€æ¸™æ•£ï¼Œè±¡å¾µæƒ…æ„Ÿã€åŒ…å®¹èˆ‡ç›´è¦ºã€‚æ°´èƒ½åŒ…å®¹ä¸€åˆ‡ï¼Œè±¡å¾µæƒ…ç·’æµå‹•èˆ‡å…±é³´ï¼Œç¼ºä¹æ°´å‰‡ç¼ºä¹åŒç†å¿ƒã€‚</li>
      <li><strong>ğŸŒ¬ï¸ é¢¨</strong> â€” ç†æ€§ã€ä¸»å‹•ã€æ¸™æ•£ï¼Œè±¡å¾µæ€è€ƒã€æºé€šèˆ‡æŒ‘æˆ°ã€‚é¢¨å¸¶ä¾†æ™ºæ…§èˆ‡è®ŠåŒ–ï¼Œæ€è€ƒä¸æ¸…æˆ–æºé€šä¸è‰¯å‰‡å®¹æ˜“é€ æˆèª¤è§£æˆ–å‚·å®³ã€‚</li>
      <li><strong>ğŸŒ åœŸ</strong> â€” ç†æ€§ã€è¢«å‹•ã€é›†ä¸­ï¼Œè±¡å¾µç‰©è³ªã€å¯¦éš›èˆ‡å®‰å…¨æ„Ÿã€‚åœŸä»£è¡¨ç©©å›ºèˆ‡ç¾å¯¦ï¼Œéåº¦å‰‡å¯èƒ½å›ºåŸ·ã€åœæ»¯ã€‚</li>
    </ul>
    <h4>ç‰Œçµ„èˆ‡å…ƒç´ </h4>
    <ul>
      <li><strong>æ¬Šæ–</strong> â€” å±¬<strong>æ„å¿—</strong>ï¼Œä¸»<strong>è¡Œå‹•</strong>ï¼Œå°æ‡‰<strong>ğŸ”¥ ç«</strong>å…ƒç´ ã€‚</li>
      <li><strong>è–æ¯</strong> â€” å±¬<strong>æ„Ÿæƒ…</strong>ï¼Œä¸»<strong>é—œä¿‚ã€ç›´è¦ºã€æƒ…æ„Ÿ</strong>ï¼Œå°æ‡‰<strong>ğŸ’§ æ°´</strong>å…ƒç´ ã€‚</li>
      <li><strong>å¯¶åŠ</strong> â€” å±¬<strong>ä¿¡å¿µ</strong>ï¼Œä¸»<strong>è¡çªã€æŒ‘æˆ°ã€æ€è€ƒ</strong>ï¼Œå°æ‡‰<strong>ğŸŒ¬ï¸ é¢¨</strong>å…ƒç´ ã€‚</li>
      <li><strong>åœ“ç›¤</strong> â€” å±¬<strong>æ„Ÿå®˜</strong>ï¼Œä¸»<strong>ç‰©è³ªã€éŒ¢è²¡ã€è‡ªç„¶</strong>ï¼Œå°æ‡‰<strong>ğŸŒ åœŸ</strong>å…ƒç´ ã€‚</li>
    </ul>
    <h4>å®®å»·ç‰Œå…ƒç´ </h4>
    <ul>
      <li><strong>é¨å£«</strong> â€” <strong>ğŸ”¥ ç«</strong>å…ƒç´ ï¼Œè±¡å¾µä¸»å‹•èˆ‡é ˜å°ã€‚</li>
      <li><strong>å¥³ç‹</strong> â€” <strong>ğŸ’§ æ°´</strong>å…ƒç´ ï¼Œè±¡å¾µå‰µé€ åŠ›èˆ‡æˆæœã€‚</li>
      <li><strong>ç‹å­</strong> â€” <strong>ğŸŒ¬ï¸ é¢¨</strong>å…ƒç´ ï¼Œè±¡å¾µå­¸ç¿’èˆ‡é–‹ç«¯ã€‚</li>
      <li><strong>å…¬ä¸»</strong> â€” <strong>ğŸŒ åœŸ</strong>å…ƒç´ ï¼Œè±¡å¾µæˆæœèˆ‡å¯¦ç¾ã€‚</li>
    </ul>
  </details>

  <!-- ç‰Œé™£æ¯”è¼ƒèˆ‡ç”¨é€” -->
  <details id="spreadComparison">
    <summary>ğŸ“˜ ç‰Œé™£æ¯”è¼ƒèˆ‡ç”¨é€”</summary>
    <ul>
      <li><strong>å–®å¼µç‰Œ</strong> â€” é©åˆæ—¥å¸¸ç°¡æ˜“çš„æå•æˆ–éœå¿ƒæŠ½ç‰Œï¼Œè¿…é€Ÿå¾—åˆ°æŒ‡å¼•ã€‚</li>
      <li><strong>æ™‚é–“ä¹‹æµ</strong> â€” åˆ†æéå»çš„åŸå› ã€ç¾åœ¨çš„ç‹€æ…‹èˆ‡æœªä¾†çš„å»ºè­°ã€‚</li>
      <li><strong>è–ä¸‰è§’</strong> â€” æ¯”è¼ƒè‡ªèº«èªçŸ¥èˆ‡ç¾å¯¦å·®ç•°ï¼Œä¸¦ç²å¾—æ”¹å–„å»ºè­°ã€‚</li>
      <li><strong>ç›´æŒ‡æ ¸å¿ƒ</strong> â€” é‡å°å•é¡Œæ ¸å¿ƒã€éšœç¤™ã€è³‡æºæå‡ºç­–ç•¥èˆ‡è¡Œå‹•æ–¹æ¡ˆã€‚</li>
      <li><strong>äºŒé¸ä¸€ï¼å¤šé¸ä¸€</strong> â€” æ¯”è¼ƒå…©å€‹é¸é …çš„ç¾æ³èˆ‡å¯èƒ½å¾Œæœï¼Œä¸¦æª¢è¦–ç•¶äº‹äººçš„å½±éŸ¿ã€‚</li>
      <li><strong>è–åå­—</strong> â€” å…¨æ–¹ä½æª¢è¦–å•é¡Œï¼ŒåŒ…æ‹¬ç¾æ³ã€æŒ‘æˆ°ã€æ·±å±¤åŸå› ã€éå»ã€æœªä¾†ã€è‡ªèº«èˆ‡ç’°å¢ƒæ…‹åº¦ï¼Œä»¥åŠæœ€çµ‚çµæœã€‚</li>
    </ul>
  </details>

  <!-- è¼‰å…¥å‹•ç•« -->
  <div class="loading-spinner" id="loadingSpinner"></div>

  <!-- çµæœé¡¯ç¤ºå€ -->
  <div id="result" aria-live="polite"></div>
  <div id="images"></div>

  <!-- æŠ½ç‰Œç´€éŒ„å€èˆ‡é™„åŠ åŠŸèƒ½ -->
  <div id="history">
    <div id="history-controls">
      <button aria-label="åˆ‡æ›ä¸»é¡Œ" onclick="toggleTheme()">ğŸ¨ åˆ‡æ›ä¸»é¡Œ</button>
      <button aria-label="åˆ†äº«çµæœåœ–ç‰‡" onclick="shareAsImage()">ğŸ–¼ï¸ åˆ†äº«åœ–ç‰‡</button>
      <button aria-label="æ¸…ç©ºæ­·å²ç´€éŒ„" onclick="clearHistory()">ğŸ§¹ æ¸…ç©ºç´€éŒ„</button>
      <button aria-label="ä¸‹è¼‰æ­·å²ç´€éŒ„" onclick="downloadHistory()">ğŸ’¾ ä¸‹è¼‰ç´€éŒ„</button>
    </div>
    <div id="history-prompts">
      <h4>ğŸ”– å¸¸ç”¨å•é¡Œ</h4>
      <ul id="promptList"></ul>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <input type="text" id="newPrompt" placeholder="è¼¸å…¥å¸¸ç”¨å•é¡Œ..." aria-label="è¼¸å…¥å¸¸ç”¨å•é¡Œ" style="flex:1;min-width:200px;">
        <button class="small-btn" aria-label="å„²å­˜å¸¸ç”¨å•é¡Œ" onclick="savePrompt()">ï¼‹ å„²å­˜</button>
      </div>
    </div>
    <h3>ğŸ“œ æŠ½ç‰Œç´€éŒ„</h3>
    <div id="historyList"></div>
  </div>

  <!-- ç‰Œç¾©è©³æƒ…å½ˆçª— -->
  <div class="modal-overlay" id="cardModal" onclick="closeModalOnOverlay(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 id="modalCardName">ç‰Œå</h2>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <img class="modal-card-image" id="modalCardImage" src="" alt="">
        <div class="modal-card-info">
          <p><span class="label">ä½ç½®ï¼š</span><span id="modalPosition">-</span></p>
          <p><span class="label">é—œéµå­—ï¼š</span><span id="modalMeaning">-</span></p>
          <p><span class="label">å…ƒç´ ï¼š</span><span id="modalElement" class="element-badge">-</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast é€šçŸ¥ -->
  <div class="toast" id="toast"></div>

  <script>
    // å¡”ç¾…ç‰Œç‰Œåº«
    const cards = [
      "0 æ„šäºº", "I é­”æ³•å¸«", "II å¥³ç¥­å¸", "III çš‡å", "IV çš‡å¸", "V å¤§ç¥­å¸",
      "VI æˆ€äºº", "VII æˆ°è»Š", "VIII èª¿ç¯€", "IX éš±è€…", "X å‘½é‹ä¹‹è¼ª",
      "XI æ…¾æœ›", "XII åŠäºº", "XIII æ­»ç¥", "XIV è—è¡“", "XV æƒ¡é­”", "XVI å¡”",
      "XVII æ˜Ÿæ˜Ÿ", "XVIII æœˆäº®", "XIX å¤ªé™½", "XX æ–°ç´€å…ƒ", "XXI å®‡å®™",
      "æ¬Šæ–ç‹ç‰Œ", "æ¬Šæ–äºŒï¼ˆçµ±æ²»ï¼‰", "æ¬Šæ–ä¸‰ï¼ˆç¾å¾·ï¼‰", "æ¬Šæ–å››ï¼ˆå®Œæˆï¼‰", "æ¬Šæ–äº”ï¼ˆçˆ­é¬¥ï¼‰",
      "æ¬Šæ–å…­ï¼ˆå‹åˆ©ï¼‰", "æ¬Šæ–ä¸ƒï¼ˆå‹‡æ°£ï¼‰", "æ¬Šæ–å…«ï¼ˆè¿…é€Ÿï¼‰", "æ¬Šæ–ä¹ï¼ˆåŠ›é‡ï¼‰", "æ¬Šæ–åï¼ˆå£“åŠ›ï¼‰",
      "æ¬Šæ–ç‹å­", "æ¬Šæ–å…¬ä¸»", "æ¬Šæ–å¥³ç‹", "æ¬Šæ–é¨å£«",
      "è–æ¯ç‹ç‰Œ", "è–æ¯äºŒï¼ˆæ„›ï¼‰", "è–æ¯ä¸‰ï¼ˆè±ç››ï¼‰", "è–æ¯å››ï¼ˆæ··äº‚ï¼‰", "è–æ¯äº”ï¼ˆå¤±æœ›ï¼‰",
      "è–æ¯å…­ï¼ˆæ„‰æ‚…ï¼‰", "è–æ¯ä¸ƒï¼ˆå¹»è±¡ï¼‰", "è–æ¯å…«ï¼ˆæ€ æƒ°ï¼‰", "è–æ¯ä¹ï¼ˆå¹¸ç¦ï¼‰", "è–æ¯åï¼ˆé£½å’Œï¼‰",
      "è–æ¯ç‹å­", "è–æ¯å…¬ä¸»", "è–æ¯å¥³ç‹", "è–æ¯é¨å£«",
      "å¯¶åŠç‹ç‰Œ", "å¯¶åŠäºŒï¼ˆå¹³è¡¡ï¼‰", "å¯¶åŠä¸‰ï¼ˆæ‚²å‚·ï¼‰", "å¯¶åŠå››ï¼ˆä¼‘æˆ°ï¼‰", "å¯¶åŠäº”ï¼ˆæ“Šæ½°ï¼‰",
      "å¯¶åŠå…­ï¼ˆç§‘å­¸ï¼‰", "å¯¶åŠä¸ƒï¼ˆè©­è¨ˆï¼‰", "å¯¶åŠå…«ï¼ˆå¹²æ¶‰ï¼‰", "å¯¶åŠä¹ï¼ˆæ®˜é…·ï¼‰", "å¯¶åŠåï¼ˆæ¯€æ»…ï¼‰",
      "å¯¶åŠç‹å­", "å¯¶åŠå…¬ä¸»", "å¯¶åŠå¥³ç‹", "å¯¶åŠé¨å£«",
      "åœ“ç›¤ç‹ç‰Œ", "åœ“ç›¤äºŒï¼ˆè®ŠåŒ–ï¼‰", "åœ“ç›¤ä¸‰ï¼ˆå·¥ä½œï¼‰", "åœ“ç›¤å››ï¼ˆæ¬ŠåŠ›ï¼‰", "åœ“ç›¤äº”ï¼ˆæ†‚æ…®ï¼‰",
      "åœ“ç›¤å…­ï¼ˆæˆåŠŸï¼‰", "åœ“ç›¤ä¸ƒï¼ˆå¤±æ•—ï¼‰", "åœ“ç›¤å…«ï¼ˆè¬¹æ…ï¼‰", "åœ“ç›¤ä¹ï¼ˆæ”¶ç©«ï¼‰", "åœ“ç›¤åï¼ˆè²¡å¯Œï¼‰",
      "åœ“ç›¤ç‹å­", "åœ“ç›¤å…¬ä¸»", "åœ“ç›¤å¥³ç‹", "åœ“ç›¤é¨å£«"
    ];

    // ç‰Œç¾©èˆ‡å…ƒç´ è³‡è¨Š
    const cardInfo = {
      "0 æ„šäºº": { meaning: "ç„¡é™æ½›èƒ½ã€ç´”çœŸã€å•Ÿç¨‹", element: "é¢¨" },
      "I é­”æ³•å¸«": { meaning: "å‰µé€ ã€æ„å¿—ã€æŒæ¡å…ƒç´ ", element: "é¢¨" },
      "II å¥³ç¥­å¸": { meaning: "æ½›æ„è­˜ã€ç¥ç¥•ç›´è¦ºã€æ²‰éœä¹‹é–€", element: "æ°´" },
      "XIII æ­»ç¥": { meaning: "è½‰è®Šã€çµ‚çµã€é‡ç”Ÿ", element: "æ°´" },
      "XV æƒ¡é­”": { meaning: "æ…¾æœ›ã€æŸç¸›ã€é™°å½±", element: "åœŸ" },
      "III çš‡å": { meaning: "è±é¥’ã€æ¯æ€§ã€å‰µé€ ", element: "åœŸ" },
      "IV çš‡å¸": { meaning: "çµæ§‹ã€ç§©åºã€é™½æ€§åŠ›é‡", element: "ç«" },
      "V å¤§ç¥­å¸": { meaning: "ä¿¡ä»°ã€å„€å¼ã€å‚³çµ±æ™ºæ…§", element: "åœŸ" },
      "VI æˆ€äºº": { meaning: "é¸æ“‡ã€çµåˆã€å…§åœ¨æ•´åˆ", element: "é¢¨" },
      "VII æˆ°è»Š": { meaning: "æ„å¿—çš„å‹åˆ©ã€å‰é€²ã€æŒæ§", element: "æ°´" },
      "VIII èª¿ç¯€": { meaning: "å¹³è¡¡ã€å…¬æ­£ã€å› æœå¾‹ã€éˆæ€§èª¿æ•´", element: "é¢¨" },
      "IX éš±è€…": { meaning: "å…§çœã€æ™ºæ…§ã€å­¤ç¨æ—…ç¨‹", element: "åœŸ" },
      "X å‘½é‹ä¹‹è¼ª": { meaning: "å‘½é‹ã€é€±æœŸã€è½‰è®Š", element: "ç«" },
      "XI æ…¾æœ›": { meaning: "å…§åœ¨å‹‡æ°£ã€æŸ”æ€§åŠ›é‡ã€æŒæ¡æœ¬èƒ½", element: "ç«" },
      "XII åŠäºº": { meaning: "çŠ§ç‰²ã€è½‰è®Šè¦–è§’ã€éˆæ€§æ‡¸æµ®", element: "æ°´" },
      "XIV è—è¡“": { meaning: "èåˆã€éŠé‡‘ã€ç¯€åˆ¶ä¹‹é“", element: "ç«" },
      "XVI å¡”": { meaning: "ç ´å£ã€è¦ºé†’ã€çªè®Š", element: "ç«" },
      "XVII æ˜Ÿæ˜Ÿ": { meaning: "å¸Œæœ›ã€éˆæ€§ä¹‹å…‰ã€å¹³éœ", element: "é¢¨" },
      "XVIII æœˆäº®": { meaning: "å¹»è±¡ã€æ½›æ„è­˜ã€è¿·éœ§", element: "æ°´" },
      "XIX å¤ªé™½": { meaning: "æˆåŠŸã€è¦ºé†’ã€å–œæ‚…", element: "ç«" },
      "XX æ–°ç´€å…ƒ": { meaning: "è¦ºé†’ã€æ•‘è´–ã€å¬å–š", element: "ç«" },
      "XXI å®‡å®™": { meaning: "æ•´åˆã€æˆå°±ã€åˆä¸€", element: "åœŸ" },
      "æ¬Šæ–ç‹ç‰Œ": { meaning: "å‰µé€ åŠ›ã€æ–°çš„é–‹å§‹ã€åŸå§‹èƒ½é‡", element: "ç«" },
      "æ¬Šæ–äºŒï¼ˆçµ±æ²»ï¼‰": { meaning: "æ¬Šå¨ã€è‡ªä¿¡ã€æ„å¿—å±•ç¾", element: "ç«" },
      "æ¬Šæ–ä¸‰ï¼ˆç¾å¾·ï¼‰": { meaning: "é è¦‹ã€æ­£ç›´ã€é“å¾·çš„å …æŒ", element: "ç«" },
      "æ¬Šæ–å››ï¼ˆå®Œæˆï¼‰": { meaning: "ç©©å®šã€æ…¶ç¥ã€å‰µé€ çš„å®Œæˆ", element: "ç«" },
      "æ¬Šæ–äº”ï¼ˆçˆ­é¬¥ï¼‰": { meaning: "æŒ‘æˆ°ã€è¡çªã€ç«¶çˆ­", element: "ç«" },
      "æ¬Šæ–å…­ï¼ˆå‹åˆ©ï¼‰": { meaning: "æˆåŠŸã€æ¦®è€€ã€ä»–äººèªå¯", element: "ç«" },
      "æ¬Šæ–ä¸ƒï¼ˆå‹‡æ°£ï¼‰": { meaning: "é˜²è¡›ã€å …æŒç«‹å ´ã€å¥®åŠ›ä¸€æ", element: "ç«" },
      "æ¬Šæ–å…«ï¼ˆè¿…é€Ÿï¼‰": { meaning: "å¿«é€Ÿç™¼å±•ã€è¨Šæ¯ã€èƒ½é‡æµå‹•", element: "ç«" },
      "æ¬Šæ–ä¹ï¼ˆåŠ›é‡ï¼‰": { meaning: "éŸŒæ€§ã€é˜²ç¦¦ã€ç•Œé™", element: "ç«" },
      "æ¬Šæ–åï¼ˆå£“åŠ›ï¼‰": { meaning: "éåº¦è² è·ã€ç–²æ†Šã€å£“æŠ‘", element: "ç«" },
      "æ¬Šæ–ç‹å­": { meaning: "æ¿€æƒ…ã€å†’éšªã€è¡å‹•ã€è‡ªä¿¡", element: "ç«" },
      "æ¬Šæ–å…¬ä¸»": { meaning: "ç´”çœŸã€å‰µé€ æœ¬èƒ½ã€é©æ–°èƒ½é‡", element: "ç«" },
      "æ¬Šæ–å¥³ç‹": { meaning: "é­…åŠ›ã€é ˜å°ã€éˆæ„Ÿå•Ÿç™¼", element: "ç«" },
      "æ¬Šæ–é¨å£«": { meaning: "ä¸»å‹•ã€é ˜å°ã€è¡å‹•ã€éˆæ„Ÿå¯¦è¸", element: "ç«" },
      "è–æ¯ç‹ç‰Œ": { meaning: "æƒ…æ„Ÿé–‹ç«¯ã€æ„›çš„ç¨®å­ã€éˆæ€§æ³‰æº", element: "æ°´" },
      "è–æ¯äºŒï¼ˆæ„›ï¼‰": { meaning: "é€£çµã€æ„›æƒ…ã€éˆé­‚ä¼´ä¾¶", element: "æ°´" },
      "è–æ¯ä¸‰ï¼ˆè±ç››ï¼‰": { meaning: "æ…¶ç¥ã€å‹æƒ…ã€æƒ…æ„Ÿåˆ†äº«", element: "æ°´" },
      "è–æ¯å››ï¼ˆæ··äº‚ï¼‰": { meaning: "æƒ…æ„Ÿåœæ»¯ã€å†·æ·¡ã€å…§åœ¨å°é–‰", element: "æ°´" },
      "è–æ¯äº”ï¼ˆå¤±æœ›ï¼‰": { meaning: "å“€å‚·ã€å¤±è½ã€æƒ…ç·’çˆ†ç™¼", element: "æ°´" },
      "è–æ¯å…­ï¼ˆæ„‰æ‚…ï¼‰": { meaning: "å›æ†¶ã€ç«¥å¿ƒã€ç¾å¥½ç‰‡æ®µ", element: "æ°´" },
      "è–æ¯ä¸ƒï¼ˆå¹»è±¡ï¼‰": { meaning: "è¿·æƒ˜ã€èª˜æƒ‘ã€æƒ…æ„Ÿéå‰©", element: "æ°´" },
      "è–æ¯å…«ï¼ˆæ€ æƒ°ï¼‰": { meaning: "æƒ…æ„Ÿæ¯ç«­ã€é€ƒé¿ã€ç„¡åŠ›æ„Ÿã€åœæ»¯", element: "æ°´" },
      "è–æ¯ä¹ï¼ˆå¹¸ç¦ï¼‰": { meaning: "æ»¿è¶³ã€æˆå°±ã€å…§åœ¨å–œæ‚…", element: "æ°´" },
      "è–æ¯åï¼ˆé£½å’Œï¼‰": { meaning: "åœ“æ»¿ã€å®¶åº­ã€æƒ…æ„Ÿå……ç›ˆ", element: "æ°´" },
      "è–æ¯ç‹å­": { meaning: "æµªæ¼«ã€å¤¢æƒ³ã€å…§çœã€ç†æƒ³åŒ–", element: "æ°´" },
      "è–æ¯å…¬ä¸»": { meaning: "ç›´è¦ºã€ç´”çœŸã€éˆæ€§è¨Šæ¯", element: "æ°´" },
      "è–æ¯å¥³ç‹": { meaning: "æ·±æƒ…ã€åŒ…å®¹ã€ç™‚ç™’ã€è‡ªæˆ‘æ²‰æ½›", element: "æ°´" },
      "è–æ¯é¨å£«": { meaning: "éˆæ€§è¿½å°‹è€…ã€è©©äººã€æƒ…æ„Ÿæ—…äºº", element: "æ°´" },
      "å¯¶åŠç‹ç‰Œ": { meaning: "æ€è€ƒçš„é–‹å§‹ã€æ¸…æ™°ã€æ„è­˜è¦ºé†’", element: "é¢¨" },
      "å¯¶åŠäºŒï¼ˆå¹³è¡¡ï¼‰": { meaning: "ç†æ€§å¹³è¡¡ã€å¯§éœã€æš«æ™‚å’Œè«§", element: "é¢¨" },
      "å¯¶åŠä¸‰ï¼ˆæ‚²å‚·ï¼‰": { meaning: "å¿ƒç—›ã€åˆ†é›¢ã€æƒ…ç·’å‰µå‚·", element: "é¢¨" },
      "å¯¶åŠå››ï¼ˆä¼‘æˆ°ï¼‰": { meaning: "ä¼‘æ¯ã€å…§çœã€æ¢å¾©", element: "é¢¨" },
      "å¯¶åŠäº”ï¼ˆæ“Šæ½°ï¼‰": { meaning: "æ“Šæ½°ã€è‡ªå°Šå—å‰µã€å´©è§£ã€ä¸å€¼å¾—çš„å‹åˆ©", element: "é¢¨" },
      "å¯¶åŠå…­ï¼ˆç§‘å­¸ï¼‰": { meaning: "ç†æ€§å‰é€²ã€çŸ¥è­˜æ•´åˆã€ç³»çµ±æ€§", element: "é¢¨" },
      "å¯¶åŠä¸ƒï¼ˆè©­è¨ˆï¼‰": { meaning: "æ¬ºçã€è¬€ç•¥ã€é€ƒé¿çœŸç›¸", element: "é¢¨" },
      "å¯¶åŠå…«ï¼ˆå¹²æ¶‰ï¼‰": { meaning: "é™åˆ¶ã€æŸç¸›ã€éåº¦æ€è€ƒ", element: "é¢¨" },
      "å¯¶åŠä¹ï¼ˆæ®˜é…·ï¼‰": { meaning: "æ¥µç«¯ç—›è‹¦ã€å…§å¿ƒæŠ˜ç£¨ã€ç„¦æ…®", element: "é¢¨" },
      "å¯¶åŠåï¼ˆæ¯€æ»…ï¼‰": { meaning: "çµ‚çµã€æ€æƒ³å´©æ½°ã€å†ç„¡é€€è·¯", element: "é¢¨" },
      "å¯¶åŠç‹å­": { meaning: "è°æ˜ã€åå›ã€è¾¯è­‰ã€è§€å¿µç¢°æ’", element: "é¢¨" },
      "å¯¶åŠå…¬ä¸»": { meaning: "æ´å¯Ÿã€åˆ†æã€å­¸ç¿’ã€å¥½å¥‡å¿ƒ", element: "é¢¨" },
      "å¯¶åŠå¥³ç‹": { meaning: "æ´å¯ŸçœŸç›¸ã€æ±ºæ–·åŠ›ã€å†·éœçš„æ…ˆæ‚²", element: "é¢¨" },
      "å¯¶åŠé¨å£«": { meaning: "å¿«é€Ÿè¡Œå‹•ã€èªè¨€æ”»å‹¢ã€çŸ¥è­˜æˆ°å£«", element: "é¢¨" },
      "åœ“ç›¤ç‹ç‰Œ": { meaning: "ç‰©è³ªèµ·é»ã€ç©©å›ºã€æ½›åŠ›çš„å¯¦ç¾", element: "åœŸ" },
      "åœ“ç›¤äºŒï¼ˆè®ŠåŒ–ï¼‰": { meaning: "è®Šå‹•ä¸­çš„ç©©å®šã€éˆæ´»ã€ç¾å¯¦é©æ‡‰åŠ›", element: "åœŸ" },
      "åœ“ç›¤ä¸‰ï¼ˆå·¥ä½œï¼‰": { meaning: "åˆä½œã€åŠªåŠ›ã€æœ‰å½¢æˆæœ", element: "åœŸ" },
      "åœ“ç›¤å››ï¼ˆæ¬ŠåŠ›ï¼‰": { meaning: "æ§åˆ¶ã€è³‡æºç´¯ç©ã€ç§©åº", element: "åœŸ" },
      "åœ“ç›¤äº”ï¼ˆæ†‚æ…®ï¼‰": { meaning: "ç„¦æ…®ã€ä¸ç©©ã€éåº¦åˆ†æã€å°æœªä¾†çš„ä¸å®‰", element: "åœŸ" },
      "åœ“ç›¤å…­ï¼ˆæˆåŠŸï¼‰": { meaning: "å‡è¡¡çµ¦äºˆã€ç‰©è³ªèª¿å’Œã€åˆ†äº«", element: "åœŸ" },
      "åœ“ç›¤ä¸ƒï¼ˆå¤±æ•—ï¼‰": { meaning: "å¤±æ•—ã€å¾’å‹ã€éŒ¯èª¤çš„å …æŒã€ç„¡æœçš„åŠªåŠ›", element: "åœŸ" },
      "åœ“ç›¤å…«ï¼ˆè¬¹æ…ï¼‰": { meaning: "ç´€å¾‹ã€å°ˆæ³¨ã€ç²¾é€²", element: "åœŸ" },
      "åœ“ç›¤ä¹ï¼ˆæ”¶ç©«ï¼‰": { meaning: "æˆæœã€å…§åœ¨å®‰å…¨æ„Ÿã€äº«å—", element: "åœŸ" },
      "åœ“ç›¤åï¼ˆè²¡å¯Œï¼‰": { meaning: "åœ“æ»¿ã€ä¸–ä¿—æˆå°±ã€ç‰©è³ªå‚³æ‰¿", element: "åœŸ" },
      "åœ“ç›¤ç‹å­": { meaning: "å¯¦è¸å‹æ€è€ƒè€…ã€è¨ˆåŠƒã€æ…¢é€Ÿæˆå°±", element: "åœŸ" },
      "åœ“ç›¤å…¬ä¸»": { meaning: "å­•è‚²ã€æ½›åŠ›ã€å¯¦é«”ä¸–ç•Œçš„å®ˆé–€äºº", element: "åœŸ" },
      "åœ“ç›¤å¥³ç‹": { meaning: "æ»‹é¤Šã€ç…§æ–™ã€ç‰©è³ªèˆ‡æ„Ÿå—çš„èåˆ", element: "åœŸ" },
      "åœ“ç›¤é¨å£«": { meaning: "åŸ·è¡Œè€…ã€ç©©å¥å‰é€²ã€ç‰©è³ªåŒ–æ„å¿—", element: "åœŸ" }
    };

    // ç‰Œé™£å®šç¾©
    const spreads = {
      single: {
        name: "å–®å¼µç‰Œ",
        count: 1,
        labels: ["ç­”æ¡ˆ"],
        description: "æŠ½ä¸€å¼µç‰Œï¼Œé©åˆæ—¥å¸¸ç°¡å–®è©¢å•æˆ–éœå¿ƒæŒ‡å¼•ã€‚"
      },
      flow: {
        name: "ä¸‰å¼µç‰Œ â€” æ™‚é–“ä¹‹æµ",
        count: 3,
        labels: ["éå»ï¼åŸå› ", "ç¾åœ¨ï¼ç‹€æ…‹", "æœªä¾†ï¼å»ºè¨€"],
        description: "é€éæ™‚é–“çš„æµå‹•ä¾†åˆ†æå•é¡Œï¼Œç¬¬ä¸€å¼µä»£è¡¨éå»èˆ‡åŸå› ï¼Œç¬¬äºŒå¼µä»£è¡¨ç¾åœ¨çš„æƒ…æ„Ÿèˆ‡çµæœï¼Œç¬¬ä¸‰å¼µæŒ‡å‘æœªä¾†çš„å»ºè­°èˆ‡éˆæ€§æŒ‡å¼•ã€‚"
      },
      trinity: {
        name: "ä¸‰å¼µç‰Œ â€” è–ä¸‰è§’",
        count: 3,
        labels: ["æˆ‘ä»¥ç‚ºçš„ç‹€æ³", "çœŸå¯¦çš„ç‹€æ³", "å»ºè¨€"],
        description: "å°ç…§è‡ªæˆ‘æ„Ÿå—èˆ‡ç¾å¯¦ç‹€æ…‹ï¼Œç¬¬ä¸‰å¼µæä¾›å°æ‡‰çš„å»ºè¨€ã€‚"
      },
      core: {
        name: "å››å¼µç‰Œ â€” ç›´æŒ‡æ ¸å¿ƒ",
        count: 4,
        labels: ["å•é¡Œæ ¸å¿ƒ", "éšœç¤™", "å°ç­–", "è³‡æºï¼é•·è™•"],
        description: "èšç„¦å•é¡Œæ ¸å¿ƒï¼Œè©•ä¼°éšœç¤™èˆ‡è³‡æºï¼Œä¸¦æä¾›å°ç­–ã€‚"
      },
      decision: {
        name: "äº”å¼µç‰Œ â€” äºŒé¸ä¸€ï¼å¤šé¸ä¸€",
        count: 5,
        labels: ["é¸é …Aç‹€æ…‹", "é¸é …Bç‹€æ…‹", "é¸é …Açµæœ", "é¸é …Bçµæœ", "ç•¶äº‹äººç‹€æ…‹"],
        description: "æ¯”è¼ƒå…©å€‹é¸é …çš„ç¾æ³èˆ‡å¯èƒ½çµæœï¼Œä¸¦æª¢è¦–ç•¶äº‹äººçš„ç‹€æ…‹ã€‚"
      },
      celtic: {
        name: "åå¼µç‰Œ â€” è–åå­—",
        count: 10,
        labels: ["ç¾æ³", "æŒ‘æˆ°", "æ½›åœ¨åŸå› ", "éå»", "å¯èƒ½æœªä¾†", "è¿‘æœŸæœªä¾†", "è‡ªèº«æ…‹åº¦", "ç’°å¢ƒçœ‹æ³•", "å¸Œæœ›ï¼ææ‡¼", "æœ€çµ‚çµæœ"],
        description: "ç¶“å…¸çš„åå­—ç‰Œé™£ï¼Œç”¨æ–¼å…¨é¢æª¢è¦–ç¾æ³ã€æŒ‘æˆ°ã€æ·±å±¤åŸå› ã€éå»ã€æœªä¾†è¶¨å‹¢ã€è‡ªèº«èˆ‡ç’°å¢ƒçš„æ…‹åº¦ä»¥åŠæœ€çµ‚çµæœã€‚"
      }
    };

    // ç‹€æ…‹è®Šæ•¸
    let lastResult = "";
    let lastSelectedCards = [];
    let lastLabels = [];
    let savedPrompts = [];

    // DOM å…ƒç´ 
    const resultDiv = document.getElementById("result");
    const imagesDiv = document.getElementById("images");
    const historyListEl = document.getElementById("historyList");
    const loadingSpinner = document.getElementById("loadingSpinner");

    // Fisher-Yates æ´—ç‰Œç®—æ³•
    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // æ›´æ–°ç‰Œé™£èªªæ˜
    function updateSpreadDescription() {
      const value = document.getElementById('spread').value;
      const spread = spreads[value];
      const desc = `${spread.description}\n\nç‰Œä½ï¼š${spread.labels.map((l, i) => `${i+1}.${l}`).join(' â†’ ')}`;
      document.getElementById('spreadDesc').innerText = desc;
    }

    // ç²å–å…ƒç´ å°æ‡‰çš„CSSé¡
    function getElementClass(element) {
      if (element.includes('ç«')) return 'element-fire';
      if (element.includes('æ°´')) return 'element-water';
      if (element.includes('é¢¨')) return 'element-air';
      if (element.includes('åœŸ') || element.includes('åœ°')) return 'element-earth';
      return '';
    }

    // ç²å–å…ƒç´ çš„ emoji
    function getElementEmoji(element) {
      if (element.includes('ç«')) return 'ğŸ”¥';
      if (element.includes('æ°´')) return 'ğŸ’§';
      if (element.includes('é¢¨')) return 'ğŸŒ¬ï¸';
      if (element.includes('åœŸ') || element.includes('åœ°')) return 'ğŸŒ';
      return 'âœ¨';
    }

    // é¡¯ç¤º Toast é€šçŸ¥
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // æŠ½ç‰Œ
    function drawSpread() {
      const selection = document.getElementById('spread').value;
      const spread = spreads[selection];
      drawCards(spread.count, spread.labels, spread.name, selection === 'celtic');
    }

    function drawCards(count, labels, spreadName, isCeltic = false) {
      const question = document.getElementById("question").value.trim();
      const shuffled = shuffle(cards);
      const selected = shuffled.slice(0, count);
      lastSelectedCards = selected;
      lastLabels = labels;

      // å»ºç«‹çµæœæ–‡å­—
      let header = `ğŸ´ æŠ½ç‰Œå•é¡Œï¼š${question || "ï¼ˆæœªè¼¸å…¥ï¼‰"}`;
      if (spreadName) header += `\nç‰Œé™£ï¼š${spreadName}`;
      header += '\n\n';

      const lines = selected.map((card, idx) => {
        const info = cardInfo[card] || {};
        const meaning = info.meaning || '';
        const element = info.element || '';
        const emoji = getElementEmoji(element);
        if (labels) {
          return `${idx + 1}. ${labels[idx]}ï¼š${card}\n   ${emoji} ${element} â€” ${meaning}`;
        }
        return `${card}\n   ${emoji} ${element} â€” ${meaning}`;
      });
      lastResult = header + lines.join('\n\n');
      resultDiv.innerText = lastResult;

      // è¨­å®šç‰Œé¢ä½ˆå±€
      if (isCeltic) {
        imagesDiv.className = 'celtic-layout';
      } else {
        imagesDiv.className = '';
      }

      // å»ºç«‹ç‰Œé¢å¡ç‰‡ï¼ˆå¸¶ç¿»ç‰Œå‹•ç•«ï¼‰
      imagesDiv.innerHTML = selected.map((card, idx) => {
        const fileName = encodeURIComponent(card);
        const imgPath = `images/thoth/${fileName}.jpg`;
        const posClass = isCeltic ? `celtic-${idx + 1}` : '';
        const labelText = labels ? labels[idx] : '';
        return `
          <div class="card-container ${posClass}" onclick="showCardDetail(${idx})" style="animation-delay: ${idx * 0.15}s">
            <div class="card-inner">
              <div class="card-back"></div>
              <div class="card-front">
                <img src="${imgPath}" alt="${card}" onerror="this.src='images/thoth/é è¨­.jpg';">
              </div>
            </div>
            ${labelText ? `<div class="card-label">${labelText}</div>` : ''}
          </div>
        `;
      }).join("");

      // ä¾åºç¿»ç‰Œå‹•ç•«
      const containers = imagesDiv.querySelectorAll('.card-container');
      containers.forEach((container, idx) => {
        setTimeout(() => {
          container.classList.add('flipped');
        }, 300 + idx * 250);
      });

      // å„²å­˜åˆ°æ­·å²ç´€éŒ„
      let history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
      history.unshift(lastResult);
      if (history.length > 10) history.pop();
      localStorage.setItem("tarotHistory", JSON.stringify(history));
      renderHistory(history);
    }

    // é¡¯ç¤ºç‰Œç¾©è©³æƒ…
    function showCardDetail(idx) {
      const card = lastSelectedCards[idx];
      const info = cardInfo[card] || {};
      const label = lastLabels ? lastLabels[idx] : '';

      document.getElementById('modalCardName').textContent = card;
      document.getElementById('modalCardImage').src = `images/thoth/${encodeURIComponent(card)}.jpg`;
      document.getElementById('modalCardImage').alt = card;
      document.getElementById('modalPosition').textContent = label || 'å–®å¼µæŠ½ç‰Œ';
      document.getElementById('modalMeaning').textContent = info.meaning || 'â€”';

      const elementEl = document.getElementById('modalElement');
      elementEl.textContent = `${getElementEmoji(info.element || '')} ${info.element || 'â€”'}`;
      elementEl.className = `element-badge ${getElementClass(info.element || '')}`;

      document.getElementById('cardModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('cardModal').classList.remove('active');
    }

    function closeModalOnOverlay(event) {
      if (event.target === document.getElementById('cardModal')) {
        closeModal();
      }
    }

    // æ¸²æŸ“æ­·å²ç´€éŒ„
    function renderHistory(history) {
      historyListEl.innerHTML = history.map((r, i) => `
        <div class="history-entry">
          <pre>${r}</pre>
          <div class="history-entry-buttons">
            <button class="small-btn" onclick="copyText(${i})">ğŸ“‹ è¤‡è£½</button>
            <button class="small-btn" onclick="deleteEntry(${i})">ğŸ—‘ï¸ åˆªé™¤</button>
          </div>
        </div>
      `).join('');
    }

    function copyText(index) {
      const history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
      navigator.clipboard.writeText(history[index]);
      showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
    }

    function deleteEntry(index) {
      let history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
      history.splice(index, 1);
      localStorage.setItem("tarotHistory", JSON.stringify(history));
      renderHistory(history);
      showToast('ç´€éŒ„å·²åˆªé™¤');
    }

    function copyResult() {
      if (!lastResult) {
        showToast('å°šç„¡çµæœå¯è¤‡è£½');
        return;
      }
      navigator.clipboard.writeText(lastResult);
      showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
    }

    // ä¸»é¡Œåˆ‡æ›
    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
      showToast(isLight ? 'å·²åˆ‡æ›è‡³æ·ºè‰²ä¸»é¡Œ' : 'å·²åˆ‡æ›è‡³æ·±è‰²ä¸»é¡Œ');
    }

    // åˆ†äº«çµæœç‚ºåœ–ç‰‡
    function shareAsImage() {
      if (!lastResult) {
        showToast('è«‹å…ˆæŠ½ç‰Œå†åˆ†äº«');
        return;
      }

      showToast('æ­£åœ¨ç”Ÿæˆåœ–ç‰‡...');

      const lines = lastResult.split('\n');
      const lineHeight = 24;
      const textHeight = lines.length * lineHeight + 40;
      const count = lastSelectedCards.length;
      const isCeltic = count === 10;

      // è¨ˆç®—ç•«å¸ƒå¤§å°
      let canvasWidth, canvasHeight, cardWidth, cardHeight;

      if (isCeltic) {
        canvasWidth = 700;
        cardWidth = 80;
        cardHeight = 120;
        canvasHeight = textHeight + 520;
      } else {
        const rows = count > 5 ? 2 : 1;
        cardWidth = 100;
        cardHeight = 150;
        canvasWidth = Math.max(600, count <= 5 ? count * (cardWidth + 15) + 40 : 5 * (cardWidth + 15) + 40);
        canvasHeight = textHeight + rows * (cardHeight + 30) + 40;
      }

      const canvas = document.createElement('canvas');
      canvas.width = canvasWidth;
      canvas.height = canvasHeight;
      const ctx = canvas.getContext('2d');

      // èƒŒæ™¯æ¼¸å±¤
      const isLight = document.body.classList.contains('light-mode');
      const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
      if (isLight) {
        gradient.addColorStop(0, '#ffffff');
        gradient.addColorStop(1, '#dde6f0');
      } else {
        gradient.addColorStop(0, '#273649');
        gradient.addColorStop(1, '#1f2b3a');
      }
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvasWidth, canvasHeight);

      // ç¹ªè£½æ–‡å­—
      ctx.fillStyle = isLight ? '#232f45' : '#e0e6ed';
      ctx.font = '16px "Segoe UI", "Noto Sans TC", sans-serif';
      ctx.textAlign = 'center';

      let y = 30;
      lines.forEach(line => {
        ctx.fillText(line, canvasWidth / 2, y);
        y += lineHeight;
      });

      // è¼‰å…¥ä¸¦ç¹ªè£½ç‰Œé¢åœ–ç‰‡
      const promises = lastSelectedCards.map(card => new Promise(resolve => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.src = 'images/thoth/' + encodeURIComponent(card) + '.jpg';
        img.onload = () => resolve(img);
        img.onerror = () => resolve(null);
      }));

      Promise.all(promises).then(imgs => {
        const startY = textHeight + 20;

        if (isCeltic) {
          // è–åå­—ä½ˆå±€ - æ¨¡æ“¬å‚³çµ±æ’åˆ—
          const positions = [
            { x: 2, y: 1 }, // 1: ç¾æ³
            { x: 2, y: 1, rotate: true }, // 2: æŒ‘æˆ°ï¼ˆæ©«æ”¾ï¼‰
            { x: 2, y: 2 }, // 3: æ½›åœ¨åŸå› 
            { x: 1, y: 1 }, // 4: éå»
            { x: 2, y: 0 }, // 5: å¯èƒ½æœªä¾†
            { x: 3, y: 1 }, // 6: è¿‘æœŸæœªä¾†
            { x: 4.5, y: 3 }, // 7: è‡ªèº«æ…‹åº¦
            { x: 4.5, y: 2 }, // 8: ç’°å¢ƒçœ‹æ³•
            { x: 4.5, y: 1 }, // 9: å¸Œæœ›/ææ‡¼
            { x: 4.5, y: 0 }  // 10: æœ€çµ‚çµæœ
          ];

          const cellW = cardWidth + 10;
          const cellH = cardHeight + 10;
          const offsetX = (canvasWidth - 5.5 * cellW) / 2;

          imgs.forEach((img, i) => {
            if (!img) return;
            const pos = positions[i];
            const x = offsetX + pos.x * cellW;
            const y = startY + pos.y * cellH;

            if (pos.rotate) {
              ctx.save();
              ctx.translate(x + cardWidth/2, y + cardHeight/2);
              ctx.rotate(Math.PI / 2);
              ctx.drawImage(img, -cardWidth/2 * 0.8, -cardHeight/2 * 0.8, cardWidth * 0.8, cardHeight * 0.8);
              ctx.restore();
            } else {
              ctx.drawImage(img, x, y, cardWidth, cardHeight);
            }
          });
        } else {
          // ä¸€èˆ¬ä½ˆå±€
          const rows = count > 5 ? 2 : 1;
          const perRow = rows === 2 ? Math.ceil(count / 2) : count;

          imgs.forEach((img, i) => {
            if (!img) return;
            const row = Math.floor(i / perRow);
            const col = i % perRow;
            const rowCount = row === 0 ? Math.min(perRow, count) : count - perRow;
            const totalWidth = rowCount * cardWidth + (rowCount - 1) * 15;
            const xStart = (canvasWidth - totalWidth) / 2;
            const x = xStart + col * (cardWidth + 15);
            const y = startY + row * (cardHeight + 30);
            ctx.drawImage(img, x, y, cardWidth, cardHeight);
          });
        }

        // åŠ å…¥æµ®æ°´å°
        ctx.fillStyle = isLight ? 'rgba(0,0,0,0.3)' : 'rgba(255,255,255,0.3)';
        ctx.font = '12px "Segoe UI"';
        ctx.textAlign = 'right';
        ctx.fillText('æ‰˜ç‰¹å¡”ç¾…æŠ½ç‰Œå™¨', canvasWidth - 15, canvasHeight - 10);

        // åŒ¯å‡º
        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = `tarot_${new Date().toISOString().slice(0,10)}.png`;
        link.click();
        showToast('åœ–ç‰‡å·²ä¸‹è¼‰ï¼');
      });
    }

    // é‡ç½®
    function resetAll() {
      document.getElementById('question').value = '';
      lastResult = '';
      lastSelectedCards = [];
      lastLabels = [];
      resultDiv.innerText = '';
      imagesDiv.innerHTML = '';
      imagesDiv.className = '';
      showToast('å·²æ¸…ç©º');
    }

    // æ¸…ç©ºæ­·å²ç´€éŒ„
    function clearHistory() {
      if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ­·å²ç´€éŒ„å—ï¼Ÿ')) return;
      localStorage.removeItem('tarotHistory');
      renderHistory([]);
      showToast('æ­·å²ç´€éŒ„å·²æ¸…ç©º');
    }

    // ä¸‹è¼‰æ­·å²ç´€éŒ„
    function downloadHistory() {
      const history = JSON.parse(localStorage.getItem('tarotHistory') || '[]');
      if (!history.length) {
        showToast('æ²’æœ‰ç´€éŒ„å¯ä¸‹è¼‰');
        return;
      }
      const content = history.join('\n\n' + 'â•'.repeat(50) + '\n\n');
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `tarot_history_${new Date().toISOString().slice(0,10)}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('ç´€éŒ„å·²ä¸‹è¼‰');
    }

    // å¸¸ç”¨å•é¡Œç®¡ç†
    function loadPrompts() {
      savedPrompts = JSON.parse(localStorage.getItem('tarotPrompts') || '[]');
      renderPrompts();
    }

    function savePrompt() {
      const input = document.getElementById('newPrompt');
      const q = input.value.trim();
      if (q) {
        savedPrompts.push(q);
        localStorage.setItem('tarotPrompts', JSON.stringify(savedPrompts));
        input.value = '';
        renderPrompts();
        showToast('å•é¡Œå·²å„²å­˜');
      }
    }

    function renderPrompts() {
      const list = savedPrompts.map((q, idx) =>
        `<li>
          <span onclick="setPrompt(${idx})">${q}</span>
          <button class="small-btn" onclick="deletePrompt(${idx})">åˆªé™¤</button>
        </li>`
      ).join('');
      document.getElementById('promptList').innerHTML = list;
    }

    function setPrompt(idx) {
      document.getElementById('question').value = savedPrompts[idx];
      showToast('å·²å¡«å…¥å•é¡Œ');
    }

    function deletePrompt(idx) {
      savedPrompts.splice(idx, 1);
      localStorage.setItem('tarotPrompts', JSON.stringify(savedPrompts));
      renderPrompts();
    }

    // éµç›¤å¿«æ·éµ
    document.addEventListener('keydown', (e) => {
      // ESC é—œé–‰å½ˆçª—
      if (e.key === 'Escape') {
        closeModal();
      }
      // Enter åœ¨è¼¸å…¥æ¡†ä¸­æŒ‰ä¸‹æ™‚æŠ½ç‰Œ
      if (e.key === 'Enter' && document.activeElement.id === 'question') {
        drawSpread();
      }
    });

    // åˆå§‹åŒ–
    window.onload = () => {
      const history = JSON.parse(localStorage.getItem('tarotHistory') || '[]');
      if (history.length > 0) renderHistory(history);

      // æ¢å¾©ä¸»é¡Œ
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
      }

      // è¼‰å…¥å¸¸ç”¨å•é¡Œ
      loadPrompts();

      // æ›´æ–°ç‰Œé™£èªªæ˜
      updateSpreadDescription();
    }
  </script>
</body>
</html>
