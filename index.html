<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰˜ç‰¹å¡”ç¾…æŠ½ç‰Œå™¨</title>
  <meta name="description" content="ä½¿ç”¨æ‰˜ç‰¹å¡”ç¾…ç‰Œé€²è¡Œå„ç¨®ç‰Œé™£ï¼šæ™‚é–“ä¹‹æµã€è–ä¸‰è§’ã€ç›´æŒ‡æ ¸å¿ƒã€äºŒé¸ä¸€ï¼å¤šé¸ä¸€ã€è–åå­—ã€‚ç®¡ç†ç´€éŒ„ã€åˆ†äº«çµæœã€åˆ‡æ›ä¸»é¡Œèˆ‡å¸¸ç”¨å•é¡Œã€‚">
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 40px;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(to bottom, #1e2a3a, #2c3e50);
      color: #e0e6ed;
      transition: background 0.3s, color 0.3s;
    }
    body.light-mode {
      background: linear-gradient(to bottom, #e3eaf2, #f5f9fc);
      color: #232f45;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
      color: #a4c3f0;
    }
    body.light-mode h1 {
      color: #4a6fa5;
    }
    input[type="text"] {
      margin-top: 10px;
      padding: 10px;
      width: 280px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background: #304258;
      color: #fff;
      outline: none;
    }
    body.light-mode input[type="text"] {
      background: #dde6f0;
      color: #232f45;
    }
    button {
      margin-top: 10px;
      padding: 10px 16px;
      font-size: 0.95rem;
      border: none;
      border-radius: 6px;
      background-color: #4a6fa5;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #6c91cc;
    }
    body.light-mode button {
      background-color: #6b8bbd;
    }
    body.light-mode button:hover {
      background-color: #8eaadd;
    }
    .small-btn {
      margin-left: 10px;
      padding: 5px 10px;
      font-size: 0.8rem;
      background-color: #3d5679;
      border-radius: 4px;
    }
    body.light-mode .small-btn {
      background-color: #9caecc;
      color: #232f45;
    }
    #result {
      margin-top: 20px;
      font-size: 1rem;
      text-align: center;
      white-space: pre-line;
      background: #273649;
      padding: 15px;
      border-radius: 10px;
      width: 90%;
      max-width: 700px;
      color: #e0e6ed;
    }
    body.light-mode #result {
      background: #ffffff;
      color: #232f45;
    }
    #images {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    #images img {
      width: 150px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    @media (max-width: 768px) {
      #images img {
        width: 45%;
      }
    }
    @media (max-width: 480px) {
      #images img {
        width: 90%;
      }
    }
    #history {
      margin-top: 30px;
      width: 90%;
      max-width: 600px;
      font-size: 0.9rem;
    }
    #history h3 {
      color: #a4c3f0;
      margin-bottom: 10px;
    }
    body.light-mode #history h3 {
      color: #4a6fa5;
    }
    .history-entry {
      background: #1f2b3a;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    body.light-mode .history-entry {
      background: #e8eff7;
    }
    .history-entry pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      margin: 0;
    }
    .history-entry-buttons {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    /* Layout for controls, prompts and descriptions */
    #spread-select,
    #spreadDesc {
      width: 90%;
      max-width: 700px;
      margin-top: 20px;
    }
    #spread-select {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    #spreadDesc {
      font-size: 0.9rem;
      white-space: pre-line;
    }

    /* History controls and prompts inside the history section */
    #history-controls, #history-prompts {
      margin-top: 20px;
    }
    #history-prompts h4 {
      margin-bottom: 10px;
      color: #a4c3f0;
    }
    body.light-mode #history-prompts h4 {
      color: #4a6fa5;
    }
    #promptList {
      list-style-type: none;
      padding: 0;
      margin-bottom: 10px;
    }
    #promptList li {
      margin-bottom: 6px;
    }
    #promptList li span {
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>ğŸƒ æ‰˜ç‰¹å¡”ç¾…æŠ½ç‰Œå™¨</h1>
  <!-- å•é¡Œè¼¸å…¥æ¡† -->
  <input type="text" id="question" placeholder="è¼¸å…¥ä½ çš„å•é¡Œ (å¯ç•™ç©º)" aria-label="è¼¸å…¥å•é¡Œ">
  <!-- ç‰Œé™£é¸æ“‡èˆ‡æŠ½ç‰ŒæŒ‰éˆ• -->
  <div id="spread-select">
    <label for="spread">é¸æ“‡ç‰Œé™£ï¼š</label>
    <select id="spread" onchange="updateSpreadDescription()">
      <option value="single">å–®å¼µç‰Œ</option>
      <option value="flow" selected>ä¸‰å¼µç‰Œ â€” æ™‚é–“ä¹‹æµ</option>
      <option value="trinity">ä¸‰å¼µç‰Œ â€” è–ä¸‰è§’</option>
      <option value="core">å››å¼µç‰Œ â€” ç›´æŒ‡æ ¸å¿ƒ</option>
      <option value="decision">äº”å¼µç‰Œ â€” äºŒé¸ä¸€ï¼å¤šé¸ä¸€</option>
      <option value="celtic">åå¼µç‰Œ â€” è–åå­—</option>
    </select>
    <button aria-label="æŠ½ç‰Œ" onclick="drawSpread()">æŠ½ç‰Œ</button>
    <button aria-label="è¤‡è£½çµæœ" onclick="copyResult()">ğŸ“‹ è¤‡è£½çµæœ</button>
      <!-- é‡ç½®çµæœæŒ‰éˆ• -->
      <button aria-label="æ¸…ç©ºçµæœ" onclick="resetAll()">ğŸ”„ æ¸…ç©ºçµæœ</button>
  </div>
  <!-- ç‰Œé™£èªªæ˜ -->
  <div id="spreadDesc"></div>
  <!-- å…ƒç´ èˆ‡ç‰Œæ„èªªæ˜æŠ˜ç–Šå€ -->
  <details id="elementGuide" style="width:90%;max-width:700px;margin-top:20px;font-size:0.9rem;">
    <summary>ğŸ” å…ƒç´ èˆ‡ç‰Œæ„èªªæ˜</summary>
    <h4>å››å¤§å…ƒç´ </h4>
    <ul>
      <li><strong>æ°´</strong> â€” æ„Ÿæ€§ã€è¢«å‹•ã€æ¸™æ•£ï¼Œè±¡å¾µæƒ…æ„Ÿã€åŒ…å®¹èˆ‡ç›´è¦ºã€‚æ°´èƒ½åŒ…å®¹ä¸€åˆ‡ï¼Œè±¡å¾µæƒ…ç·’æµå‹•èˆ‡å…±é³´ï¼Œç¼ºä¹æ°´å‰‡ç¼ºä¹åŒç†å¿ƒã€‚</li>
      <li><strong>ç«</strong> â€” æ„Ÿæ€§ã€ä¸»å‹•ã€é›†ä¸­ï¼Œè±¡å¾µæ„å¿—ã€è¡Œå‹•èˆ‡ç†±æƒ…ã€‚ç«å¸¶ä¾†å‹•åŠ›èˆ‡å†’éšªç²¾ç¥ï¼Œä½†éæ–¼ç†¾ç†±å¯èƒ½è‡ªæˆ‘ä¸­å¿ƒã€å¿½ç•¥ä»–äººã€‚</li>
      <li><strong>é¢¨</strong> â€” ç†æ€§ã€ä¸»å‹•ã€æ¸™æ•£ï¼Œè±¡å¾µæ€è€ƒã€æºé€šèˆ‡æŒ‘æˆ°ã€‚é¢¨å¸¶ä¾†æ™ºæ…§èˆ‡è®ŠåŒ–ï¼Œæ€è€ƒä¸æ¸…æˆ–æºé€šä¸è‰¯å‰‡å®¹æ˜“é€ æˆèª¤è§£æˆ–å‚·å®³ã€‚</li>
      <li><strong>åœŸ</strong> â€” ç†æ€§ã€è¢«å‹•ã€é›†ä¸­ï¼Œè±¡å¾µç‰©è³ªã€å¯¦éš›èˆ‡å®‰å…¨æ„Ÿã€‚åœŸä»£è¡¨ç©©å›ºèˆ‡ç¾å¯¦ï¼Œéåº¦å‰‡å¯èƒ½å›ºåŸ·ã€åœæ»¯ã€‚</li>
    </ul>
    <h4>ç‰Œçµ„èˆ‡å…ƒç´ </h4>
    <ul>
      <li><strong>æ¬Šæ–</strong> â€” å±¬<strong>æ„å¿—</strong>ï¼Œä¸»<strong>è¡Œå‹•</strong>ï¼Œå°æ‡‰<strong>ç«</strong>å…ƒç´ ã€‚</li>
      <li><strong>è–æ¯</strong> â€” å±¬<strong>æ„Ÿæƒ…</strong>ï¼Œä¸»<strong>é—œä¿‚ã€ç›´è¦ºã€æƒ…æ„Ÿ</strong>ï¼Œå°æ‡‰<strong>æ°´</strong>å…ƒç´ ã€‚</li>
      <li><strong>å¯¶åŠ</strong> â€” å±¬<strong>ä¿¡å¿µ</strong>ï¼Œä¸»<strong>è¡çªã€æŒ‘æˆ°ã€æ€è€ƒ</strong>ï¼Œå°æ‡‰<strong>é¢¨</strong>å…ƒç´ ã€‚</li>
      <li><strong>åœ“ç›¤</strong> â€” å±¬<strong>æ„Ÿå®˜</strong>ï¼Œä¸»<strong>ç‰©è³ªã€éŒ¢è²¡ã€è‡ªç„¶</strong>ï¼Œå°æ‡‰<strong>åœŸ</strong>å…ƒç´ ã€‚</li>
    </ul>
    <h4>å®®å»·ç‰Œå…ƒç´ </h4>
    <ul>
      <li><strong>çš‡å</strong> â€” <strong>æ°´</strong>å…ƒç´ ï¼Œè±¡å¾µå‰µé€ åŠ›èˆ‡æˆæœã€‚</li>
      <li><strong>é¨å£«</strong> â€” <strong>ç«</strong>å…ƒç´ ï¼Œè±¡å¾µéç¨‹èˆ‡é€²å±•ã€‚</li>
      <li><strong>ç‹å­</strong> â€” <strong>é¢¨</strong>å…ƒç´ ï¼Œè±¡å¾µå­¸ç¿’èˆ‡é–‹ç«¯ã€‚</li>
      <li><strong>å…¬ä¸»</strong> â€” <strong>åœŸ</strong>å…ƒç´ ï¼Œè±¡å¾µæˆæœèˆ‡æˆåŠŸã€‚</li>
    </ul>
    <h4>é™°æ€§èˆ‡é™½æ€§</h4>
    <p><strong>é™½æ€§</strong>ä»£è¡¨ä¸»å‹•ã€å¤–å‘ã€å¤ªé™½çš„èƒ½é‡ï¼›<strong>é™°æ€§</strong>ä»£è¡¨è¢«å‹•ã€å…§å‘ã€æœˆäº®çš„èƒ½é‡ã€‚å…ƒç´ çš„ä¸»å‹•æˆ–è¢«å‹•ç‰¹è³ªæœƒå½±éŸ¿ç‰Œæ„çš„è¡¨ç¾ï¼Œä¾‹å¦‚æ°´èˆ‡åœŸå±¬æ–¼é™°æ€§ï¼Œç«èˆ‡é¢¨å±¬æ–¼é™½æ€§ã€‚</p>
  </details>

  <!-- ç‰Œé™£æ¯”è¼ƒèˆ‡ç”¨é€” -->
  <details id="spreadComparison" style="width:90%;max-width:700px;margin-top:20px;font-size:0.9rem;">
    <summary>ğŸ“˜ ç‰Œé™£æ¯”è¼ƒèˆ‡ç”¨é€”</summary>
    <p>æœ¬ç‰Œé™£æ¯”è¼ƒç¸½çµæ¯å€‹ç‰Œé™£çš„ç›®çš„èˆ‡é©ç”¨æƒ…å¢ƒï¼š</p>
    <ul>
      <li><strong>å–®å¼µç‰Œ</strong> â€” é©åˆæ—¥å¸¸ç°¡æ˜“çš„æå•æˆ–éœå¿ƒæŠ½ç‰Œï¼Œè¿…é€Ÿå¾—åˆ°æŒ‡å¼•ã€‚</li>
      <li><strong>æ™‚é–“ä¹‹æµ</strong> â€” åˆ†æéå»çš„åŸå› ã€ç¾åœ¨çš„ç‹€æ…‹èˆ‡æœªä¾†çš„å»ºè­°ã€‚</li>
      <li><strong>è–ä¸‰è§’</strong> â€” æ¯”è¼ƒè‡ªèº«èªçŸ¥èˆ‡ç¾å¯¦å·®ç•°ï¼Œä¸¦ç²å¾—æ”¹å–„å»ºè­°ã€‚</li>
      <li><strong>ç›´æŒ‡æ ¸å¿ƒ</strong> â€” é‡å°å•é¡Œæ ¸å¿ƒã€éšœç¤™ã€è³‡æºæå‡ºç­–ç•¥èˆ‡è¡Œå‹•æ–¹æ¡ˆã€‚</li>
      <li><strong>äºŒé¸ä¸€ï¼å¤šé¸ä¸€</strong> â€” æ¯”è¼ƒå…©å€‹é¸é …çš„ç¾æ³èˆ‡å¯èƒ½å¾Œæœï¼Œä¸¦æª¢è¦–ç•¶äº‹äººçš„å½±éŸ¿ã€‚</li>
      <li><strong>è–åå­—</strong> â€” å…¨æ–¹ä½æª¢è¦–å•é¡Œï¼ŒåŒ…æ‹¬ç¾æ³ã€æŒ‘æˆ°ã€æ·±å±¤åŸå› ã€éå»ã€æœªä¾†ã€è‡ªèº«èˆ‡ç’°å¢ƒæ…‹åº¦ï¼Œä»¥åŠæœ€çµ‚çµæœã€‚</li>
    </ul>
  </details>
  <!-- çµæœé¡¯ç¤ºå€ -->
  <div id="result" aria-live="polite"></div>
  <div id="images"></div>
  <!-- æŠ½ç‰Œç´€éŒ„å€èˆ‡é™„åŠ åŠŸèƒ½ -->
  <div id="history">
    <!-- æ§åˆ¶æŒ‰éˆ•èˆ‡å¸¸ç”¨å•é¡Œæ”¾åœ¨æœ€ä¸Šæ–¹ -->
    <div id="history-controls">
      <button aria-label="åˆ‡æ›ä¸»é¡Œ" onclick="toggleTheme()">ğŸ¨ åˆ‡æ›ä¸»é¡Œ</button>
      <button aria-label="åˆ†äº«çµæœåœ–ç‰‡" onclick="shareAsImage()">ğŸ–¼ï¸ åˆ†äº«çµæœåœ–ç‰‡</button>
      <!-- æ¸…ç©ºæ­·å²ç´€éŒ„ -->
      <button aria-label="æ¸…ç©ºæ­·å²ç´€éŒ„" onclick="clearHistory()">ğŸ§¹ æ¸…ç©ºç´€éŒ„</button>
      <!-- ä¸‹è¼‰æ­·å²ç´€éŒ„ -->
      <button aria-label="ä¸‹è¼‰æ­·å²ç´€éŒ„" onclick="downloadHistory()">ğŸ’¾ ä¸‹è¼‰ç´€éŒ„</button>
    </div>
    <div id="history-prompts">
      <h4>ğŸ”– å¸¸ç”¨å•é¡Œï¼š</h4>
      <ul id="promptList"></ul>
      <input type="text" id="newPrompt" placeholder="è¼¸å…¥å¸¸ç”¨å•é¡Œ..." aria-label="è¼¸å…¥å¸¸ç”¨å•é¡Œ">
      <button class="small-btn" aria-label="å„²å­˜å¸¸ç”¨å•é¡Œ" onclick="savePrompt()">ï¼‹ å„²å­˜å•é¡Œ</button>
    </div>
    <h3>ğŸ“œ æŠ½ç‰Œç´€éŒ„ï¼š</h3>
    <!-- æ­·å²åˆ—è¡¨æœƒåœ¨ JS ä¸­å¡«å…… -->
    <div id="historyList"></div>
  </div>

  <script>
    // Tarot card list (Thoth deck, no reversals needed)
    const cards = [
      "0 æ„šäºº", "I é­”æ³•å¸«", "II å¥³ç¥­å¸", "III çš‡å", "IV çš‡å¸", "V å¤§ç¥­å¸",
      "VI æˆ€äºº", "VII æˆ°è»Š", "VIII èª¿ç¯€", "IX éš±è€…", "X å‘½é‹ä¹‹è¼ª",
      "XI æ…¾æœ›", "XII åŠäºº", "XIII æ­»ç¥", "XIV è—è¡“", "XV æƒ¡é­”", "XVI å¡”",
      "XVII æ˜Ÿæ˜Ÿ", "XVIII æœˆäº®", "XIX å¤ªé™½", "XX æ–°ç´€å…ƒ", "XXI å®‡å®™",
      "æ¬Šæ–ç‹ç‰Œ", "æ¬Šæ–äºŒï¼ˆçµ±æ²»ï¼‰", "æ¬Šæ–ä¸‰ï¼ˆç¾å¾·ï¼‰", "æ¬Šæ–å››ï¼ˆå®Œæˆï¼‰", "æ¬Šæ–äº”ï¼ˆçˆ­é¬¥ï¼‰",
      "æ¬Šæ–å…­ï¼ˆå‹åˆ©ï¼‰", "æ¬Šæ–ä¸ƒï¼ˆå‹‡æ°£ï¼‰", "æ¬Šæ–å…«ï¼ˆè¿…é€Ÿï¼‰", "æ¬Šæ–ä¹ï¼ˆåŠ›é‡ï¼‰", "æ¬Šæ–åï¼ˆå£“åŠ›ï¼‰",
      "æ¬Šæ–ç‹å­", "æ¬Šæ–å…¬ä¸»", "æ¬Šæ–å¥³ç‹", "æ¬Šæ–é¨å£«",
      "è–æ¯ç‹ç‰Œ", "è–æ¯äºŒï¼ˆæ„›ï¼‰", "è–æ¯ä¸‰ï¼ˆè±ç››ï¼‰", "è–æ¯å››ï¼ˆæ··äº‚ï¼‰", "è–æ¯äº”ï¼ˆå¤±æœ›ï¼‰",
      "è–æ¯å…­ï¼ˆæ„‰æ‚…ï¼‰", "è–æ¯ä¸ƒï¼ˆå¹»è±¡ï¼‰", "è–æ¯å…«ï¼ˆæ€ æƒ°ï¼‰", "è–æ¯ä¹ï¼ˆå¹¸ç¦ï¼‰", "è–æ¯åï¼ˆé£½å’Œï¼‰",
      "è–æ¯ç‹å­", "è–æ¯å…¬ä¸»", "è–æ¯å¥³ç‹", "è–æ¯é¨å£«",
      "å¯¶åŠç‹ç‰Œ", "å¯¶åŠäºŒï¼ˆå¹³è¡¡ï¼‰", "å¯¶åŠä¸‰ï¼ˆæ‚²å‚·ï¼‰", "å¯¶åŠå››ï¼ˆä¼‘æˆ°ï¼‰", "å¯¶åŠäº”ï¼ˆæ“Šæ½°ï¼‰",
      "å¯¶åŠå…­ï¼ˆç§‘å­¸ï¼‰", "å¯¶åŠä¸ƒï¼ˆè©­è¨ˆï¼‰", "å¯¶åŠå…«ï¼ˆå¹²æ¶‰ï¼‰", "å¯¶åŠä¹ï¼ˆæ®˜é…·ï¼‰", "å¯¶åŠåï¼ˆæ¯€æ»…ï¼‰",
      "å¯¶åŠç‹å­", "å¯¶åŠå…¬ä¸»", "å¯¶åŠå¥³ç‹", "å¯¶åŠé¨å£«",
      "åœ“ç›¤ç‹ç‰Œ", "åœ“ç›¤äºŒï¼ˆè®ŠåŒ–ï¼‰", "åœ“ç›¤ä¸‰ï¼ˆå·¥ä½œï¼‰", "åœ“ç›¤å››ï¼ˆæ¬ŠåŠ›ï¼‰", "åœ“ç›¤äº”ï¼ˆæ†‚æ…®ï¼‰",
      "åœ“ç›¤å…­ï¼ˆæˆåŠŸï¼‰", "åœ“ç›¤ä¸ƒï¼ˆå¤±æ•—ï¼‰", "åœ“ç›¤å…«ï¼ˆè¬¹æ…ï¼‰", "åœ“ç›¤ä¹ï¼ˆæ”¶ç©«ï¼‰", "åœ“ç›¤åï¼ˆè²¡å¯Œï¼‰",
      "åœ“ç›¤ç‹å­", "åœ“ç›¤å…¬ä¸»", "åœ“ç›¤å¥³ç‹", "åœ“ç›¤é¨å£«"
    ];

    // Card information mapping: meaning and element for each Thoth card
    // Source: thoth_tarot_full.json, using the "- é—œéµå­—" as meaning and "- å…ƒç´ " as element
    const cardInfo = {
      "0 æ„šäºº": { meaning: "ç„¡é™æ½›èƒ½ã€ç´”çœŸã€å•Ÿç¨‹", element: "é¢¨ï¼ˆAirï¼‰" },
      "I é­”æ³•å¸«": { meaning: "å‰µé€ ã€æ„å¿—ã€æŒæ¡å…ƒç´ ", element: "é¢¨ï¼ˆAirï¼‰" },
      "II å¥³ç¥­å¸": { meaning: "æ½›æ„è­˜ã€ç¥ç¥•ç›´è¦ºã€æ²‰éœä¹‹é–€", element: "æ°´ï¼ˆWaterï¼‰" },
      "XIII æ­»ç¥": { meaning: "è½‰è®Šã€çµ‚çµã€é‡ç”Ÿ", element: "æ°´ï¼ˆWaterï¼‰" },
      "XV æƒ¡é­”": { meaning: "æ…¾æœ›ã€æŸç¸›ã€é™°å½±", element: "åœŸï¼ˆEarthï¼‰" },
      "III çš‡å": { meaning: "è±é¥’ã€æ¯æ€§ã€å‰µé€ ", element: "åœŸï¼ˆEarthï¼‰" },
      "IV çš‡å¸": { meaning: "çµæ§‹ã€ç§©åºã€é™½æ€§åŠ›é‡", element: "ç«ï¼ˆFireï¼‰" },
      "V å¤§ç¥­å¸": { meaning: "ä¿¡ä»°ã€å„€å¼ã€å‚³çµ±æ™ºæ…§", element: "åœŸï¼ˆEarthï¼‰" },
      "VI æˆ€äºº": { meaning: "é¸æ“‡ã€çµåˆã€å…§åœ¨æ•´åˆ", element: "é¢¨ï¼ˆAirï¼‰" },
      "VII æˆ°è»Š": { meaning: "æ„å¿—çš„å‹åˆ©ã€å‰é€²ã€æŒæ§", element: "æ°´ï¼ˆWaterï¼‰" },
      "VIII èª¿ç¯€": { meaning: "å¹³è¡¡ã€å…¬æ­£ã€å› æœå¾‹ã€éˆæ€§èª¿æ•´", element: "é¢¨ï¼ˆAirï¼‰" },
      "IX éš±å£«": { meaning: "å…§çœã€æ™ºæ…§ã€å­¤ç¨æ—…ç¨‹", element: "åœ°ï¼ˆEarthï¼‰" },
      "X å‘½é‹ä¹‹è¼ª": { meaning: "å‘½é‹ã€é€±æœŸã€è½‰è®Š", element: "ç«ï¼ˆFireï¼‰" },
      "XI æ…¾æœ›": { meaning: "å…§åœ¨å‹‡æ°£ã€æŸ”æ€§åŠ›é‡ã€æŒæ¡æœ¬èƒ½", element: "ç«ï¼ˆFireï¼‰" },
      "XII åŠäºº": { meaning: "çŠ§ç‰²ã€è½‰è®Šè¦–è§’ã€éˆæ€§æ‡¸æµ®", element: "æ°´ï¼ˆWaterï¼‰" },
      "XIV è—è¡“": { meaning: "èåˆã€éŠé‡‘ã€ç¯€åˆ¶ä¹‹é“", element: "ç«ï¼ˆFireï¼‰" },
      "XVI å¡”": { meaning: "ç ´å£ã€è¦ºé†’ã€çªè®Š", element: "ç«ï¼ˆFireï¼‰" },
      "XVII æ˜Ÿæ˜Ÿ": { meaning: "å¸Œæœ›ã€éˆæ€§ä¹‹å…‰ã€å¹³éœ", element: "é¢¨ï¼ˆAirï¼‰" },
      "XVIII æœˆäº®": { meaning: "å¹»è±¡ã€æ½›æ„è­˜ã€è¿·éœ§", element: "æ°´ï¼ˆWaterï¼‰" },
      "XIX å¤ªé™½": { meaning: "æˆåŠŸã€è¦ºé†’ã€å–œæ‚…", element: "ç«ï¼ˆFireï¼‰" },
      "XX æ–°ç´€å…ƒ": { meaning: "è¦ºé†’ã€æ•‘è´–ã€å¬å–š", element: "ç«ï¼ˆFireï¼‰" },
      "XXI å®‡å®™": { meaning: "æ•´åˆã€æˆå°±ã€åˆä¸€", element: "åœŸï¼ˆEarthï¼‰" },
      "æ¬Šæ–ç‹ç‰Œ": { meaning: "å‰µé€ åŠ›ã€æ–°çš„é–‹å§‹ã€åŸå§‹èƒ½é‡", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–äºŒï¼ˆçµ±æ²»ï¼‰": { meaning: "æ¬Šå¨ã€è‡ªä¿¡ã€æ„å¿—å±•ç¾", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–ä¸‰ï¼ˆç¾å¾·ï¼‰": { meaning: "é è¦‹ã€æ­£ç›´ã€é“å¾·çš„å …æŒ", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–å››ï¼ˆå®Œæˆï¼‰": { meaning: "ç©©å®šã€æ…¶ç¥ã€å‰µé€ çš„å®Œæˆ", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–äº”ï¼ˆçˆ­é¬¥ï¼‰": { meaning: "æŒ‘æˆ°ã€è¡çªã€ç«¶çˆ­", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–å…­ï¼ˆå‹åˆ©ï¼‰": { meaning: "æˆåŠŸã€æ¦®è€€ã€ä»–äººèªå¯", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–ä¸ƒï¼ˆå‹‡æ°£ï¼‰": { meaning: "é˜²è¡›ã€å …æŒç«‹å ´ã€å¥®åŠ›ä¸€æ", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–å…«ï¼ˆè¿…é€Ÿï¼‰": { meaning: "å¿«é€Ÿç™¼å±•ã€è¨Šæ¯ã€èƒ½é‡æµå‹•", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–ä¹ï¼ˆåŠ›é‡ï¼‰": { meaning: "éŸŒæ€§ã€é˜²ç¦¦ã€ç•Œé™", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–åï¼ˆå£“åŠ›ï¼‰": { meaning: "éåº¦è² è·ã€ç–²æ†Šã€å£“æŠ‘", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–ç‹å­": { meaning: "æ¿€æƒ…ã€å†’éšªã€è¡å‹•ã€è‡ªä¿¡", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–å…¬ä¸»": { meaning: "ç´”çœŸã€å‰µé€ æœ¬èƒ½ã€é©æ–°èƒ½é‡", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–å¥³ç‹": { meaning: "é­…åŠ›ã€é ˜å°ã€éˆæ„Ÿå•Ÿç™¼", element: "ç«ï¼ˆFireï¼‰" },
      "æ¬Šæ–é¨å£«": { meaning: "ä¸»å‹•ã€é ˜å°ã€è¡å‹•ã€éˆæ„Ÿå¯¦è¸", element: "ç«ï¼ˆFireï¼‰" },
      "è–æ¯ç‹ç‰Œ": { meaning: "æƒ…æ„Ÿé–‹ç«¯ã€æ„›çš„ç¨®å­ã€éˆæ€§æ³‰æº", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯äºŒï¼ˆæ„›ï¼‰": { meaning: "é€£çµã€æ„›æƒ…ã€éˆé­‚ä¼´ä¾¶", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯ä¸‰ï¼ˆè±ç››ï¼‰": { meaning: "æ…¶ç¥ã€å‹æƒ…ã€æƒ…æ„Ÿåˆ†äº«", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯å››ï¼ˆæ··äº‚ï¼‰": { meaning: "æƒ…æ„Ÿåœæ»¯ã€å†·æ·¡ã€å…§åœ¨å°é–‰", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯äº”ï¼ˆå¤±æœ›ï¼‰": { meaning: "å“€å‚·ã€å¤±è½ã€æƒ…ç·’çˆ†ç™¼", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯å…­ï¼ˆæ„‰æ‚…ï¼‰": { meaning: "å›æ†¶ã€ç«¥å¿ƒã€ç¾å¥½ç‰‡æ®µ", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯ä¸ƒï¼ˆå¹»è±¡ï¼‰": { meaning: "è¿·æƒ˜ã€èª˜æƒ‘ã€æƒ…æ„Ÿéå‰©", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯å…«ï¼ˆæ€ æƒ°ï¼‰": { meaning: "æƒ…æ„Ÿæ¯ç«­ã€é€ƒé¿ã€ç„¡åŠ›æ„Ÿã€åœæ»¯", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯ä¹ï¼ˆå¹¸ç¦ï¼‰": { meaning: "æ»¿è¶³ã€æˆå°±ã€å…§åœ¨å–œæ‚…", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯åï¼ˆé£½å’Œï¼‰": { meaning: "åœ“æ»¿ã€å®¶åº­ã€æƒ…æ„Ÿå……ç›ˆ", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯ç‹å­": { meaning: "æµªæ¼«ã€å¤¢æƒ³ã€å…§çœã€ç†æƒ³åŒ–", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯å…¬ä¸»": { meaning: "ç›´è¦ºã€ç´”çœŸã€éˆæ€§è¨Šæ¯", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯å¥³ç‹": { meaning: "æ·±æƒ…ã€åŒ…å®¹ã€ç™‚ç™’ã€è‡ªæˆ‘æ²‰æ½›", element: "æ°´ï¼ˆWaterï¼‰" },
      "è–æ¯é¨å£«": { meaning: "éˆæ€§è¿½å°‹è€…ã€è©©äººã€æƒ…æ„Ÿæ—…äºº", element: "æ°´ï¼ˆWaterï¼‰" },
      "å¯¶åŠç‹ç‰Œ": { meaning: "æ€è€ƒçš„é–‹å§‹ã€æ¸…æ™°ã€æ„è­˜è¦ºé†’", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠäºŒï¼ˆå¹³è¡¡ï¼‰": { meaning: "ç†æ€§å¹³è¡¡ã€å¯§éœã€æš«æ™‚å’Œè«§", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠä¸‰ï¼ˆæ‚²å‚·ï¼‰": { meaning: "å¿ƒç—›ã€åˆ†é›¢ã€æƒ…ç·’å‰µå‚·", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠå››ï¼ˆä¼‘æˆ°ï¼‰": { meaning: "ä¼‘æ¯ã€å…§çœã€æ¢å¾©", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠäº”ï¼ˆæ“Šæ½°ï¼‰": { meaning: "æ“Šæ½°ã€è‡ªå°Šå—å‰µã€å´©è§£ã€ä¸å€¼å¾—çš„å‹åˆ©", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠå…­ï¼ˆç§‘å­¸ï¼‰": { meaning: "ç†æ€§å‰é€²ã€çŸ¥è­˜æ•´åˆã€ç³»çµ±æ€§", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠä¸ƒï¼ˆè©­è¨ˆï¼‰": { meaning: "æ¬ºçã€è¬€ç•¥ã€é€ƒé¿çœŸç›¸", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠå…«ï¼ˆå¹²æ¶‰ï¼‰": { meaning: "é™åˆ¶ã€æŸç¸›ã€éåº¦æ€è€ƒ", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠä¹ï¼ˆæ®˜é…·ï¼‰": { meaning: "æ¥µç«¯ç—›è‹¦ã€å…§å¿ƒæŠ˜ç£¨ã€ç„¦æ…®", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠåï¼ˆæ¯€æ»…ï¼‰": { meaning: "çµ‚çµã€æ€æƒ³å´©æ½°ã€å†ç„¡é€€è·¯", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠç‹å­": { meaning: "è°æ˜ã€åå›ã€è¾¯è­‰ã€è§€å¿µç¢°æ’", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠå…¬ä¸»": { meaning: "æ´å¯Ÿã€åˆ†æã€å­¸ç¿’ã€å¥½å¥‡å¿ƒ", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠå¥³ç‹": { meaning: "æ´å¯ŸçœŸç›¸ã€æ±ºæ–·åŠ›ã€å†·éœçš„æ…ˆæ‚²", element: "é¢¨ï¼ˆAirï¼‰" },
      "å¯¶åŠé¨å£«": { meaning: "å¿«é€Ÿè¡Œå‹•ã€èªè¨€æ”»å‹¢ã€çŸ¥è­˜æˆ°å£«", element: "é¢¨ï¼ˆAirï¼‰" },
      "åœ“ç›¤ç‹ç‰Œ": { meaning: "ç‰©è³ªèµ·é»ã€ç©©å›ºã€æ½›åŠ›çš„å¯¦ç¾", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤äºŒï¼ˆè®ŠåŒ–ï¼‰": { meaning: "è®Šå‹•ä¸­çš„ç©©å®šã€éˆæ´»ã€ç¾å¯¦é©æ‡‰åŠ›", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤ä¸‰ï¼ˆå·¥ä½œï¼‰": { meaning: "åˆä½œã€åŠªåŠ›ã€æœ‰å½¢æˆæœ", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤å››ï¼ˆæ¬ŠåŠ›ï¼‰": { meaning: "æ§åˆ¶ã€è³‡æºç´¯ç©ã€ç§©åº", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤äº”ï¼ˆæ†‚æ…®ï¼‰": { meaning: "ç„¦æ…®ã€ä¸ç©©ã€éåº¦åˆ†æã€å°æœªä¾†çš„ä¸å®‰", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤å…­ï¼ˆæˆåŠŸï¼‰": { meaning: "å‡è¡¡çµ¦äºˆã€ç‰©è³ªèª¿å’Œã€åˆ†äº«", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤ä¸ƒï¼ˆå¤±æ•—ï¼‰": { meaning: "å¤±æ•—ã€å¾’å‹ã€éŒ¯èª¤çš„å …æŒã€ç„¡æœçš„åŠªåŠ›", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤å…«ï¼ˆè¬¹æ…ï¼‰": { meaning: "ç´€å¾‹ã€å°ˆæ³¨ã€ç²¾é€²", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤ä¹ï¼ˆæ”¶ç©«ï¼‰": { meaning: "æˆæœã€å…§åœ¨å®‰å…¨æ„Ÿã€äº«å—", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤åï¼ˆè²¡å¯Œï¼‰": { meaning: "åœ“æ»¿ã€ä¸–ä¿—æˆå°±ã€ç‰©è³ªå‚³æ‰¿", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤ç‹å­": { meaning: "å¯¦è¸å‹æ€è€ƒè€…ã€è¨ˆåŠƒã€æ…¢é€Ÿæˆå°±", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤å…¬ä¸»": { meaning: "å­•è‚²ã€æ½›åŠ›ã€å¯¦é«”ä¸–ç•Œçš„å®ˆé–€äºº", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤å¥³ç‹": { meaning: "æ»‹é¤Šã€ç…§æ–™ã€ç‰©è³ªèˆ‡æ„Ÿå—çš„èåˆ", element: "åœŸï¼ˆEarthï¼‰" },
      "åœ“ç›¤é¨å£«": { meaning: "åŸ·è¡Œè€…ã€ç©©å¥å‰é€²ã€ç‰©è³ªåŒ–æ„å¿—", element: "åœŸï¼ˆEarthï¼‰" }
    };

    // Spread definitions
    const spreads = {
      single: {
        name: "å–®å¼µç‰Œ",
        count: 1,
        labels: ["ç­”æ¡ˆ"],
        description: "æŠ½ä¸€å¼µç‰Œï¼Œé©åˆæ—¥å¸¸ç°¡å–®è©¢å•æˆ–éœå¿ƒæŒ‡å¼•ã€‚"
      },
      flow: {
        name: "ä¸‰å¼µç‰Œ â€” æ™‚é–“ä¹‹æµ",
        count: 3,
        labels: ["éå»ï¼åŸå› ï¼èº«", "ç¾åœ¨ï¼å¿ƒï¼ç›®å‰çµæœ", "æœªä¾†ï¼å»ºè¨€ï¼éˆ"],
        description: "é€éæ™‚é–“çš„æµå‹•ä¾†åˆ†æå•é¡Œï¼Œç¬¬ä¸€å¼µä»£è¡¨éå»èˆ‡åŸå› ï¼Œç¬¬äºŒå¼µä»£è¡¨ç¾åœ¨çš„æƒ…æ„Ÿèˆ‡çµæœï¼Œç¬¬ä¸‰å¼µæŒ‡å‘æœªä¾†çš„å»ºè­°èˆ‡éˆæ€§æŒ‡å¼•ã€‚"
      },
      trinity: {
        name: "ä¸‰å¼µç‰Œ â€” è–ä¸‰è§’",
        count: 3,
        labels: ["æˆ‘ä»¥ç‚ºçš„ç‹€æ³", "çœŸå¯¦çš„ç‹€æ³", "å»ºè¨€"],
        description: "å°ç…§è‡ªæˆ‘æ„Ÿå—èˆ‡ç¾å¯¦ç‹€æ…‹ï¼Œç¬¬ä¸‰å¼µæä¾›å°æ‡‰çš„å»ºè¨€ã€‚"
      },
      core: {
        name: "å››å¼µç‰Œ â€” ç›´æŒ‡æ ¸å¿ƒ",
        count: 4,
        labels: ["å•é¡Œæ ¸å¿ƒ", "éšœç¤™", "å°ç­–", "è³‡æºï¼é•·è™•"],
        description: "èšç„¦å•é¡Œæ ¸å¿ƒï¼Œè©•ä¼°éšœç¤™èˆ‡è³‡æºï¼Œä¸¦æä¾›å°ç­–ã€‚"
      },
      decision: {
        name: "äº”å¼µç‰Œ â€” äºŒé¸ä¸€ï¼å¤šé¸ä¸€",
        count: 5,
        labels: ["é¸é …Açš„ç‹€æ…‹", "é¸é …Bçš„ç‹€æ…‹", "é¸é …Aå¯èƒ½çš„çµæœ", "é¸é …Bå¯èƒ½çš„çµæœ", "ç•¶äº‹äººçš„ç‹€æ…‹"],
        description: "æ¯”è¼ƒå…©å€‹é¸é …çš„ç¾æ³èˆ‡å¯èƒ½çµæœï¼Œä¸¦æª¢è¦–ç•¶äº‹äººçš„ç‹€æ…‹ã€‚"
      },
      celtic: {
        name: "åå¼µç‰Œ â€” è–åå­—",
        count: 10,
        labels: ["ç¾æ³", "æŒ‘æˆ°", "æ½›åœ¨åŸå› ", "éå»", "å¯èƒ½çš„æœªä¾†", "è¿‘æœŸçš„æœªä¾†", "è‡ªèº«æ…‹åº¦", "ç’°å¢ƒï¼å‘¨åœçœ‹æ³•", "å¸Œæœ›ï¼ææ‡¼", "æœ€çµ‚çµæœ"],
        description: "ç¶“å…¸çš„åå­—ç‰Œé™£ï¼Œç”¨æ–¼å…¨é¢æª¢è¦–ç¾æ³ã€æŒ‘æˆ°ã€æ·±å±¤åŸå› ã€éå»ã€æœªä¾†è¶¨å‹¢ã€è‡ªèº«èˆ‡ç’°å¢ƒçš„æ…‹åº¦ä»¥åŠæœ€çµ‚çµæœã€‚"
      }
    };

    let lastResult = "";
    let lastSelectedCards = [];
    const resultDiv = document.getElementById("result");
    const imagesDiv = document.getElementById("images");
    const historyDiv = document.getElementById("history");
    // Container for the dynamic history entries list
    const historyListEl = document.getElementById("historyList");
    let savedPrompts = [];

    // Shuffle function
    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // Update spread description
    function updateSpreadDescription() {
      const value = document.getElementById('spread').value;
      const spread = spreads[value];
      const desc = `${spread.description}\n\nç‰Œä½èªªæ˜ï¼š\n` +
        spread.labels.map((label, idx) => `${idx + 1}. ${label}`).join('\n');
      document.getElementById('spreadDesc').innerText = desc;
    }

    // Draw the selected spread
    function drawSpread() {
      const selection = document.getElementById('spread').value;
      const spread = spreads[selection];
      drawCards(spread.count, spread.labels, spread.name);
    }

    function drawCards(count, labels = null, spreadName = null) {
      const question = document.getElementById("question").value.trim();
      const shuffled = shuffle(cards);
      const selected = shuffled.slice(0, count);
      lastSelectedCards = selected;

      // Build result string
      let header = `ğŸ´ æŠ½ç‰Œå•é¡Œï¼š${question || "ï¼ˆæœªè¼¸å…¥ï¼‰"}`;
      if (spreadName) {
        header += `\nç‰Œé™£ï¼š${spreadName}`;
      }
      header += '\n\n';
      // Build each line with card name, meaning and element
      const lines = selected.map((card, idx) => {
        const info = cardInfo[card] || {};
        const meaning = info.meaning || '';
        const element = info.element || '';
        if (labels) {
          return `${idx + 1}. ${labels[idx]}ï¼š${card} â€” ${meaning}ï¼ˆ${element}ï¼‰`;
        }
        // For single-card or unnamed spreads
        const prefix = count === 1 ? '' : `${idx + 1}. `;
        return `${prefix}${card} â€” ${meaning}ï¼ˆ${element}ï¼‰`;
      });
      lastResult = header + lines.join('\n');
      resultDiv.innerText = lastResult;

      imagesDiv.innerHTML = selected.map(card => {
        const fileName = encodeURIComponent(card);
        const imgPath = `images/thoth/${fileName}.jpg`;
        return `<img src="${imgPath}" alt="${card}" onerror="this.onerror=null;this.src='images/thoth/é è¨­.jpg';">`;
      }).join("");
      // æ ¹æ“šç‰Œæ•¸èª¿æ•´é é¢ä¸Šç‰Œåœ–æ’ç‰ˆ
      if (count === 10) {
        // ä½¿ç”¨gridå°‡è–åå­—çš„åå¼µç‰Œåˆ†æˆå…©æ’äº”å¼µï¼Œç½®ä¸­æ’åˆ—
        imagesDiv.style.display = 'grid';
        imagesDiv.style.gridTemplateColumns = 'repeat(5, 1fr)';
        imagesDiv.style.justifyItems = 'center';
        const imgs = imagesDiv.querySelectorAll('img');
        imgs.forEach(img => {
          img.style.width = '110px';
          img.style.height = 'auto';
        });
      } else {
        // å…¶ä»–ç‰Œé™£æ¢å¾©flexæ’ç‰ˆ
        imagesDiv.style.display = 'flex';
        imagesDiv.style.gridTemplateColumns = '';
        imagesDiv.style.justifyItems = '';
        const imgs = imagesDiv.querySelectorAll('img');
        imgs.forEach(img => {
          img.style.width = '';
          img.style.height = '';
        });
      }

      // Save to history
      let history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
      history.unshift(lastResult);
      if (history.length > 10) history.pop();
      localStorage.setItem("tarotHistory", JSON.stringify(history));
      renderHistory(history);
    }

    function renderHistory(history) {
      // Populate only the history list, keep header and controls untouched
      historyListEl.innerHTML = history.map((r, i) => `
        <div class="history-entry">
          <pre>${r}</pre>
          <div class="history-entry-buttons">
            <button class="small-btn" aria-label="è¤‡è£½ç¬¬ ${i + 1} ç­†ç´€éŒ„" onclick="copyText(${i})">ğŸ“‹ è¤‡è£½</button>
            <button class="small-btn" aria-label="åˆªé™¤ç¬¬ ${i + 1} ç­†ç´€éŒ„" onclick="deleteEntry(${i})">ğŸ—‘ï¸ åˆªé™¤</button>
          </div>
        </div>
      `).join('');
    }

    function copyText(index) {
      const history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
      navigator.clipboard.writeText(history[index]);
    }

    function deleteEntry(index) {
      let history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
      history.splice(index, 1);
      localStorage.setItem("tarotHistory", JSON.stringify(history));
      renderHistory(history);
    }

    function copyResult() {
      navigator.clipboard.writeText(lastResult);
    }

    // Theme toggle
    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    }

    // Share result as image
    function shareAsImage() {
      if (!lastResult) return;
      // è¨ˆç®—æ–‡å­—è¡Œæ•¸èˆ‡é«˜åº¦
      const lines = lastResult.split('\n');
      const lineHeight = 22;
      const textHeight = lines.length * lineHeight + 20;
      const rows = lastSelectedCards.length > 5 ? 2 : 1;
      const isCeltic = lastSelectedCards.length === 10;
      const baseCardHeight = isCeltic ? 160 : 130;
      const height = Math.max(400, textHeight + rows * baseCardHeight + 30);
      const width = isCeltic ? 800 : 600;
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      // èƒŒæ™¯æ¼¸å±¤
      const isLight = document.body.classList.contains('light-mode');
      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      if (isLight) {
        gradient.addColorStop(0, '#ffffff');
        gradient.addColorStop(1, '#dde6f0');
      } else {
        gradient.addColorStop(0, '#273649');
        gradient.addColorStop(1, '#1f2b3a');
      }
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, width, height);
      ctx.fillStyle = isLight ? '#232f45' : '#e0e6ed';
      ctx.font = '16px Segoe UI';
      // ç¹ªè£½æ–‡å­—æ°´å¹³ç½®ä¸­
      let y = 30;
      lines.forEach(line => {
        const textWidth = ctx.measureText(line).width;
        const x = (width - textWidth) / 2;
        ctx.fillText(line, x, y);
        y += lineHeight;
      });
      // è¼‰å…¥ç‰Œé¢åœ–ç‰‡
      const promises = lastSelectedCards.map(card => new Promise(resolve => {
        const img = new Image();
        img.src = 'images/thoth/' + encodeURIComponent(card) + '.jpg';
        img.onload = () => resolve(img);
        img.onerror = () => resolve(null);
      }));
      Promise.all(promises).then(imgs => {
        const count = lastSelectedCards.length;
        if (rows === 2) {
          const perRow = (count === 10) ? 5 : Math.ceil(count / 2);
          const baseCardWidth = isCeltic ? 100 : 80;
          // ä¸Šæ’
          const cardWidthTop = Math.min(baseCardWidth, (width - 40) / perRow - 8);
          const totalTopWidth = perRow * cardWidthTop + (perRow - 1) * 8;
          const xStartTop = (width - totalTopWidth) / 2;
          const yTop = height - baseCardHeight * 2 - 10;
          // ä¸‹æ’
          const remaining = count - perRow;
          const cardWidthBottom = Math.min(baseCardWidth, (width - 40) / remaining - 8);
          const totalBottomWidth = remaining * cardWidthBottom + (remaining - 1) * 8;
          const xStartBottom = (width - totalBottomWidth) / 2;
          const yBottom = height - baseCardHeight - 10;
          imgs.forEach((img, i) => {
            if (!img) return;
            if (i < perRow) {
              const xPos = xStartTop + i * (cardWidthTop + 8);
              ctx.drawImage(img, xPos, yTop, cardWidthTop, baseCardHeight);
            } else {
              const j = i - perRow;
              const xPos = xStartBottom + j * (cardWidthBottom + 8);
              ctx.drawImage(img, xPos, yBottom, cardWidthBottom, baseCardHeight);
            }
          });
        } else {
          const baseCardWidth = isCeltic ? 100 : 80;
          const cardWidth = Math.min(baseCardWidth, (width - 40) / count - 8);
          const totalWidth = count * cardWidth + (count - 1) * 8;
          const xStart = (width - totalWidth) / 2;
          const yOffset = height - baseCardHeight - 10;
          imgs.forEach((img, i) => {
            if (!img) return;
            const xPos = xStart + i * (cardWidth + 8);
            ctx.drawImage(img, xPos, yOffset, cardWidth, baseCardHeight);
          });
        }
        // åŒ¯å‡ºåœ–æª”
        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = 'tarot_result.png';
        link.click();
      });
    }

    // é‡ç½®è¼¸å…¥èˆ‡çµæœ
    function resetAll() {
      document.getElementById('question').value = '';
      lastResult = '';
      lastSelectedCards = [];
      resultDiv.innerText = '';
      imagesDiv.innerHTML = '';
    }

    // æ¸…ç©ºæ­·å²ç´€éŒ„
    function clearHistory() {
      localStorage.removeItem('tarotHistory');
      renderHistory([]);
    }

    // ä¸‹è¼‰æ­·å²ç´€éŒ„
    function downloadHistory() {
      const history = JSON.parse(localStorage.getItem('tarotHistory') || '[]');
      if (!history.length) return;
      const content = history.join('\n\n---\n\n');
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'tarot_history.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Prompt management
    function loadPrompts() {
      savedPrompts = JSON.parse(localStorage.getItem('tarotPrompts') || '[]');
      renderPrompts();
    }

    function savePrompt() {
      const input = document.getElementById('newPrompt');
      const q = input.value.trim();
      if (q) {
        savedPrompts.push(q);
        localStorage.setItem('tarotPrompts', JSON.stringify(savedPrompts));
        input.value = '';
        renderPrompts();
      }
    }

    function renderPrompts() {
      const list = savedPrompts.map((q, idx) => `<li><span onclick="setPrompt(${idx})">${q}</span> <button class="small-btn" onclick="deletePrompt(${idx})">åˆªé™¤</button></li>`).join('');
      document.getElementById('promptList').innerHTML = list;
    }

    function setPrompt(idx) {
      document.getElementById('question').value = savedPrompts[idx];
    }

    function deletePrompt(idx) {
      savedPrompts.splice(idx, 1);
      localStorage.setItem('tarotPrompts', JSON.stringify(savedPrompts));
      renderPrompts();
    }

    // Onload: restore history, prompts, theme, and update spread description
    window.onload = () => {
      const history = JSON.parse(localStorage.getItem('tarotHistory') || '[]');
      if (history.length > 0) renderHistory(history);
      // restore theme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
      }
      // load prompts
      loadPrompts();
      // update description
      updateSpreadDescription();
    }
  </script>
</body>
</html>
